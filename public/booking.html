<!DOCTYPE html>
<html lang="en">
<head>
	<base href="/" />
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
	    <title>Seoul City Tour Tiger Bus - Book Your Tour</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="template.css">
    <style>
        /* Booking Page Specific Styles */
        .booking-page-content {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            padding-top: 120px;
            position: relative;
            z-index: 1;
        }

        .booking-page-container {
            background: white;
            border-radius: 16px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .booking-page-header {
            background: #E20021;
            color: white;
            padding: 20px 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .booking-page-header h1 {
            font-size: 24px;
            font-weight: 600;
            margin: 0;
        }

        .booking-step-page {
            display: none;
            padding: 0;
        }

        .booking-step-page.active {
            display: block;
        }

        .step-title-section {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 20px 24px;
            border-bottom: 1px solid #eee;
        }

        .step-title-section .step-number {
            width: 32px;
            height: 32px;
            background: #E20021;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 16px;
        }

        .step-title-section .step-title {
            font-size: 18px;
            font-weight: 600;
            color: #333;
        }

        .booking-inner-container {
            padding: 24px;
        }

        /* Tour Display */
        .tour-display {
            position: relative;
            border-radius: 12px;
            overflow: hidden;
            margin-bottom: 20px;
            height: 200px;
            background: #f5f5f5;
        }

        .tour-display img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            object-position: center;
        }

        .tour-label {
            position: absolute;
            top: 16px;
            left: 16px;
            padding: 4px 12px;
            border-radius: 4px;
            font-weight: 600;
            font-size: 14px;
            color: white;
        }

        .popular-badge {
            position: absolute;
            top: 16px;
            right: 16px;
            background: #E31E24;
            color: white;
            padding: 4px 12px;
            border-radius: 4px;
            font-weight: 600;
            font-size: 14px;
        }

        .tour-title {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 16px;
            background: linear-gradient(to bottom, transparent, rgba(0,0,0,0.8));
            color: white;
            font-weight: 600;
        }

        /* Tour Selector */
        .tour-selector {
            margin-bottom: 20px;
        }

        .tour-selector select {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 15px;
            background: white;
            cursor: pointer;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23333' d='M6 8L1 3h10z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 16px center;
        }

        /* Tour Info Panel - Sliding bullet points */
        .tour-info-panel {
            width: 100%;
            overflow: hidden;
            margin-bottom: 15px;
        }

        .tour-info-content {
            max-height: 0;
            overflow: hidden;
            opacity: 0;
            transition: max-height 0.4s ease-out, opacity 0.3s ease-out, padding 0.3s ease-out;
            padding: 0;
        }

        .tour-info-content.active {
            max-height: 200px;
            opacity: 1;
            padding: 10px 0;
        }

        .tour-info-content ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .tour-info-content ul li {
            position: relative;
            padding-left: 20px;
            margin-bottom: 8px;
            font-size: 14px;
            color: #333;
            line-height: 1.5;
        }

        .tour-info-content ul li:last-child {
            margin-bottom: 0;
        }

        .tour-info-content ul li::before {
            content: "â€¢";
            position: absolute;
            left: 5px;
            color: #D40004;
            font-weight: bold;
        }

        .tour-info-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 15px;
        }

        .tour-info-row ul {
            flex: 1;
        }

        .tour-map-btn-wrapper {
            flex-shrink: 0;
        }

        .tour-map-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 20px;
            background: linear-gradient(135deg, #D40004 0%, #A50000 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.25s ease;
            box-shadow: 0 2px 8px rgba(164, 0, 0, 0.3);
        }

        .tour-map-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(164, 0, 0, 0.4);
        }

        .tour-map-btn svg {
            stroke: white;
        }

        /* Tour Map Popup */
        .tour-map-popup-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 999999;
            justify-content: center;
            align-items: center;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .tour-map-popup-overlay.active {
            display: flex;
            opacity: 1;
        }

        .tour-map-popup {
            position: relative;
            max-width: 90%;
            max-height: 90%;
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
            animation: popupSlideIn 0.3s ease-out;
        }

        @keyframes popupSlideIn {
            from {
                transform: scale(0.9) translateY(20px);
                opacity: 0;
            }
            to {
                transform: scale(1) translateY(0);
                opacity: 1;
            }
        }

        .tour-map-popup-close {
            position: absolute;
            top: 10px;
            right: 10px;
            width: 36px;
            height: 36px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            border: none;
            border-radius: 50%;
            font-size: 24px;
            line-height: 1;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            z-index: 1;
        }

        .tour-map-popup-close:hover {
            background: #D40004;
            transform: scale(1.1);
        }

        .tour-map-content {
            width: 600px;
            height: 800px;
            max-width: 90vw;
            max-height: 80vh;
            background: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 20px;
        }

        .tour-map-icon {
            width: 120px;
            height: 120px;
        }

        .tour-map-label {
            font-size: 24px;
            font-weight: 600;
            color: #333;
            margin: 0;
        }

        .tour-map-image {
            display: block;
            max-width: 100%;
            max-height: 80vh;
            object-fit: contain;
        }

        /* Date Selector */
        .date-selector {
            margin-bottom: 20px;
        }

        .date-picker-wrapper {
            position: relative;
            width: 100%;
        }

        .date-picker-trigger {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            font-size: 15px;
            box-sizing: border-box;
        }

        .calendar-icon {
            width: 20px;
            height: 20px;
        }

        .calendar-dropdown {
            display: none;
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            width: 100%;
            max-width: 350px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
            z-index: 50;
            margin-top: 8px;
            padding: 16px;
            box-sizing: border-box;
        }

        .calendar-dropdown.active {
            display: block;
        }

        .calendar-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 16px;
        }

        .calendar-header button {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 18px;
            padding: 8px;
        }

        .calendar-header .current-month {
            font-size: 16px;
            font-weight: 600;
        }

        .close-calendar {
            position: absolute;
            top: 10px;
            right: 10px;
        }

        .weekdays {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            text-align: center;
            margin-bottom: 8px;
        }

        .weekdays span {
            font-size: 12px;
            color: #666;
            padding: 8px;
        }

        .days {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 4px;
        }

        .days .day {
            padding: 10px;
            text-align: center;
            cursor: pointer;
            border-radius: 50%;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .days .day:hover:not(.disabled) {
            background: #f5f5f5;
        }

        .days .day.selected {
            background: #E20021;
            color: white;
        }

        .days .day.disabled {
            color: #999;
            background-color: #f0f0f0;
            cursor: not-allowed;
            opacity: 0.6;
        }

        .days .day .dot {
            position: absolute;
            bottom: 2px;
            width: 6px;
            height: 6px;
            border-radius: 50%;
        }

        .days .day .dot.available {
            background-color: #4CAF50;
        }

        .days .day .dot.sold-out {
            background-color: #F44336;
        }

        .calendar-footer {
            margin-top: 16px;
            padding-top: 16px;
            border-top: 1px solid #eee;
        }

        .availability-legend {
            display: flex;
            gap: 16px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 12px;
            color: #666;
        }

        .legend-item .dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
        }

        .legend-item .dot.available {
            background: #4CAF50;
        }

        .legend-item .dot.sold-out {
            background: #F44336;
        }

        /* Ticket Selection */
        .ticket-selection {
            margin-bottom: 20px;
        }

        .ticket-type {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 12px;
            border: 1px solid #eee;
        }

        .ticket-info {
            margin-bottom: 12px;
        }

        .ticket-label {
            font-size: 18px;
            font-weight: 600;
            color: #333;
            margin-bottom: 4px;
        }

        .age-range {
            font-size: 14px;
            color: #666;
        }

        .price-counter {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-top: 12px;
            border-top: 1px solid #eee;
        }

        .price {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .current-price {
            font-size: 20px;
            font-weight: 600;
            color: #E20021;
        }

        .original-price {
            font-size: 14px;
            color: #888;
            text-decoration: line-through;
        }

        .counter {
            display: flex;
            align-items: center;
            gap: 12px;
            background: white;
            padding: 8px 12px;
            border-radius: 8px;
            border: 1px solid #eee;
        }

        .counter button {
            width: 32px;
            height: 32px;
            border: 1px solid #ddd;
            background: white;
            border-radius: 6px;
            font-size: 16px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .counter button:hover {
            background: #f5f5f5;
        }

        .counter input {
            width: 40px;
            height: 32px;
            text-align: center;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 16px;
        }

        /* Total Summary */
        .total-summary {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid #eee;
        }

        .ticket-total {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .total-label {
            font-size: 18px;
            font-weight: 700;
            color: #333;
        }

        .total-price {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .current-total {
            font-size: 24px;
            font-weight: 800;
            color: #E20021;
        }

        .original-total {
            font-size: 16px;
            color: #888;
            text-decoration: line-through;
        }

        /* Cross-sell Section */
        .cross-sell-section {
            margin-top: 30px;
            padding-top: 30px;
            border-top: 1px solid #eee;
        }

        .cross-sell-section h2 {
            font-size: 22px;
            color: #333;
            margin-bottom: 8px;
	            text-align: center;
        }

        .cross-sell-subtitle {
            font-size: 14px;
            color: #666;
            margin-bottom: 20px;
	            text-align: center;
        }

        .category-tabs {
            display: flex;
            gap: 12px;
            margin-bottom: 20px;
	            	    justify-content: center;
	            flex-wrap: wrap;
        }

        .category-tab {
            padding: 10px 20px;
            border: 1px solid #ddd;
            background: white;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            white-space: nowrap;
            transition: all 0.3s ease;
        }

        .category-tab.active {
            background: #E20021;
            color: white;
            border-color: #E20021;
        }

        .products-grid {
            display: none;
        }

        .products-grid.active {
            display: block;
        }

        /* Cross-sell Carousel */
        .cross-sell-carousel {
            position: relative;
            overflow: hidden;
        }

        .cross-sell-slide {
            display: none;
        }

        .cross-sell-slide.active {
            display: block;
        }

        .product-card {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            position: relative;
            transition: opacity 0.3s ease;
        }

        /* Incompatible product card styling */
        .product-card.incompatible {
            pointer-events: none;
        }

        .product-card.incompatible .product-image,
        .product-card.incompatible .product-info,
        .product-card.incompatible .product-badge {
            opacity: 0.5;
        }

        .product-card.incompatible .view-btn {
            display: none;
        }

        .product-incompatible-label {
            display: none;
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: #E20021;
            color: white;
            padding: 10px 12px;
            font-size: 11px;
            font-weight: 600;
            text-align: center;
            line-height: 1.3;
            z-index: 10;
        }

        .product-card.incompatible .product-incompatible-label {
            display: block;
        }

        .product-badge {
            position: absolute;
            top: 12px;
            left: 12px;
            background: #E20021;
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            z-index: 10;
        }

        .product-image {
            height: 200px;
            overflow: hidden;
        }

        .product-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .product-image.placeholder-image {
            background: linear-gradient(135deg, #f5f5f5 0%, #e0e0e0 100%);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .image-placeholder {
            font-size: 64px;
            opacity: 0.7;
        }

        .product-info {
            padding: 16px;
        }

        .product-info h3 {
            font-size: 18px;
            margin-bottom: 8px;
            color: #333;
        }

        .product-info p {
            font-size: 14px;
            color: #666;
            margin-bottom: 12px;
            line-height: 1.5;
        }

        .upsell-pricing {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 12px;
        }

        .upsell-pricing .discount-badge {
            position: static;
            background: #E20021;
            color: white;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 13px;
            font-weight: 600;
            line-height: 1;
        }

        .upsell-current-price {
            font-size: 18px;
            font-weight: 700;
            color: #666;
        }

        .upsell-original-price {
            font-size: 14px;
            color: #888;
            text-decoration: line-through;
        }

        /* Type indicators for product cards */
        .type-indicator {
            font-size: 12px;
            padding: 4px 10px;
            border-radius: 12px;
            display: inline-block;
            margin-top: 8px;
        }

        .type-indicator.scheduled {
            background: #E3F2FD;
            color: #1976D2;
        }

        .type-indicator.validity {
            background: #E8F5E9;
            color: #388E3C;
        }

        .type-indicator.physical {
            background: #FFF3E0;
            color: #F57C00;
        }

        /* Cart item type badges */
        .cart-item-type {
            font-size: 10px;
            padding: 2px 6px;
            border-radius: 8px;
            margin-left: 8px;
            font-weight: 500;
        }

        .cart-item-type.scheduled {
            background: #E3F2FD;
            color: #1976D2;
        }

        .cart-item-type.validity {
            background: #E8F5E9;
            color: #388E3C;
        }

        .cart-item-type.physical {
            background: #FFF3E0;
            color: #F57C00;
        }

        /* Cart item placeholder for products without images */
        .cart-item-placeholder {
            width: 50px;
            height: 50px;
            border-radius: 8px;
            background: #f5f5f5;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }

        .view-btn {
            background: #E20021;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.3s ease;
        }

        .view-btn:hover {
            background: #c00;
        }

        .cross-sell-nav {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
            cursor: pointer;
            font-size: 18px;
            z-index: 10;
        }

        .cross-sell-nav.prev {
            left: 10px;
        }

        .cross-sell-nav.next {
            right: 10px;
        }

        .cross-sell-dots {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-top: 16px;
        }

        .cross-sell-dots .dot {
            width: 8px;
            height: 8px;
            background: #ddd;
            border-radius: 50%;
            cursor: pointer;
        }

        .cross-sell-dots .dot.active {
            background: #E20021;
        }

        /* Continue Button */
        .continue-btn {
            width: 100%;
            padding: 16px;
            background: #E20021;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 20px;
            transition: background 0.3s ease;
        }

        .continue-btn:hover {
            background: #c00;
        }

        /* Back Button */
        .back-btn {
            background: none;
            border: none;
            color: #666;
            font-size: 16px;
            cursor: pointer;
            padding: 10px 0;
            margin-bottom: 10px;
        }

        .back-btn:hover {
            color: #333;
        }

        /* Cancellation Info */
        .cancellation-info {
            background: #fff9e6;
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
        }

        .cancellation-info h3 {
            font-size: 16px;
            font-weight: 600;
            color: #333;
            margin-bottom: 12px;
        }

        .refund-rates p {
            font-size: 14px;
            color: #666;
            margin-bottom: 6px;
        }

        .night-tour-warning {
            font-size: 12px;
            color: #E20021;
            margin-top: 12px;
        }

        /* Floating Cart Bar - Full Width Desktop Style */
        .upsell-cart-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            width: 100%;
            background: #E20021;
            color: white;
            padding: 16px 40px;
            z-index: 9999;
            transform: translateY(100%);
            transition: transform 0.3s ease;
            box-shadow: 0 -4px 20px rgba(0,0,0,0.15);
        }

        .upsell-cart-bar.visible {
            transform: translateY(0);
        }

        .cart-bar-content {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .cart-bar-left {
            display: flex;
            align-items: center;
            gap: 24px;
        }

        .cart-bar-icon {
            position: relative;
        }

        .cart-bar-icon svg {
            width: 28px;
            height: 28px;
        }

        .cart-badge {
            position: absolute;
            top: -8px;
            right: -8px;
            background: white;
            color: #E20021;
            width: 22px;
            height: 22px;
            border-radius: 50%;
            font-size: 12px;
            font-weight: 700;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .cart-bar-info {
            display: flex;
            align-items: center;
            gap: 24px;
        }

        .cart-bar-items {
            font-size: 15px;
            opacity: 0.9;
        }

        .cart-bar-total {
            font-size: 20px;
            font-weight: 700;
        }

        .cart-bar-right {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .view-cart-btn {
            background: white;
            color: #E20021;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.2s ease;
        }

        .view-cart-btn:hover {
            background: #f5f5f5;
            transform: scale(1.02);
        }

        /* Cart Expanded */
        .cart-bar-expanded {
            display: none;
            background: white;
            color: #333;
            padding: 24px 40px;
            border-radius: 16px 16px 0 0;
            margin: 16px -40px -16px;
            max-height: 400px;
            overflow-y: auto;
        }

        .cart-bar-expanded.visible {
            display: block;
        }

        .cart-expanded-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
            max-width: 1200px;
            margin-left: auto;
            margin-right: auto;
            margin-bottom: 20px;
        }

        .cart-expanded-header h4 {
            font-size: 20px;
            font-weight: 600;
        }

        .collapse-cart-btn {
            background: none;
            border: none;
            cursor: pointer;
            padding: 8px;
            border-radius: 50%;
            transition: background 0.2s ease;
        }

        .collapse-cart-btn:hover {
            background: #f5f5f5;
        }

        .cart-items-list {
            max-width: 1200px;
            margin: 0 auto;
        }

        .cart-expanded-footer {
            max-width: 1200px;
            margin: 16px auto 0;
            padding-top: 16px;
            border-top: 1px solid #eee;
        }

        /* Add padding to main content when cart is visible */
        body.cart-visible .booking-page-content {
            padding-bottom: 100px;
        }

        .cart-items-list {
            max-height: 200px;
            overflow-y: auto;
        }

        .cart-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #eee;
        }

        .cart-item-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .cart-item-image {
            width: 50px;
            height: 50px;
            border-radius: 8px;
            object-fit: cover;
        }

        .cart-item-details h5 {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .cart-item-details span {
            font-size: 12px;
            color: #666;
        }

        .cart-item-price {
            font-weight: 600;
            color: #E20021;
        }

        .cart-expanded-footer {
            margin-top: 16px;
            padding-top: 16px;
            border-top: 1px solid #eee;
        }

        .cart-savings {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            color: #4CAF50;
        }

        .cart-total-row {
            display: flex;
            justify-content: space-between;
            font-size: 18px;
            font-weight: 600;
        }

        /* User Info Form */
        .user-info-form {
            padding: 0;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            font-size: 14px;
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
        }

        .form-group input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 15px;
        }

        .form-group input:focus {
            outline: none;
            border-color: #E20021;
        }

        .info-text {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 8px;
            font-size: 12px;
            color: #666;
        }

        .info-icon {
            width: 16px;
            height: 16px;
            background: #ddd;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
        }

        .terms-section {
            margin-top: 24px;
        }

        .terms-text-box {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 16px;
            max-height: 120px;
            overflow-y: auto;
            margin-bottom: 16px;
            font-size: 13px;
            color: #666;
        }

        .terms-checkbox {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 12px;
        }

        .terms-checkbox input {
            width: 18px;
            height: 18px;
        }

        .terms-checkbox label {
            font-size: 14px;
            color: #333;
        }

        .terms-content {
            font-size: 12px;
            color: #666;
        }

        /* Order Summary */
        .order-summary {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .order-summary h4 {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 16px;
        }

        .order-section {
            margin-bottom: 16px;
        }

        .order-section-title {
            font-size: 14px;
            font-weight: 600;
            color: #666;
            margin-bottom: 12px;
        }

        .order-tour-date {
            color: #E20021;
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 12px;
            padding: 8px 12px;
            background: rgba(226, 0, 33, 0.08);
            border-radius: 6px;
            display: inline-block;
        }

        .order-tour-date:empty {
            display: none;
        }

        .order-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #eee;
        }

        .order-item-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .order-item-image {
            width: 60px;
            height: 60px;
            border-radius: 8px;
            object-fit: cover;
        }

        .order-item-details h5 {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .order-item-meta {
            font-size: 12px;
            color: #666;
        }

        .order-item-controls {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .order-item-qty {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .order-item-qty button {
            width: 28px;
            height: 28px;
            border: 1px solid #ddd;
            background: white;
            border-radius: 4px;
            cursor: pointer;
        }

        .order-item-qty span {
            font-weight: 600;
        }

        /* Read-only quantity display for payment step - matches index.html */
        .qty-display {
            font-weight: 400;
            color: #666;
            font-size: 14px;
        }

        .order-item-price {
            text-align: right;
        }

        .order-item-current {
            font-size: 16px;
            font-weight: 600;
            color: #E20021;
        }

        .order-item-original {
            font-size: 12px;
            color: #888;
            text-decoration: line-through;
        }

        .remove-item-btn,
        .step2-remove-addon-btn {
            background: none;
            border: none;
            color: #999;
            cursor: pointer;
            font-size: 18px;
            padding: 4px 8px;
            margin-left: 8px;
            border-radius: 4px;
            transition: all 0.2s ease;
        }

        .remove-item-btn:hover,
        .step2-remove-addon-btn:hover {
            color: #E20021;
            background-color: rgba(226, 0, 33, 0.1);
        }

        .order-totals {
            margin-top: 16px;
            padding-top: 16px;
            border-top: 2px solid #ddd;
        }

        .order-totals > div {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .order-totals .total {
            font-size: 18px;
            font-weight: 700;
        }

        .order-totals .savings {
            color: #4CAF50;
        }

        .order-totals .discount {
            color: #E20021;
        }

        /* Payment Methods */
        .payment-methods {
            margin-bottom: 20px;
        }

        .credit-card-section h4 {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 12px;
        }

        .card-logos {
            display: flex;
            gap: 16px;
            margin-bottom: 20px;
        }

        .card-logos img {
            height: 30px;
            width: auto;
        }

        .alternative-payments {
            display: flex;
            gap: 16px;
        }

        .payment-option {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            cursor: pointer;
        }

        .payment-option:hover {
            border-color: #E20021;
        }

        .payment-option img {
            height: 24px;
            width: auto;
        }

        .footer-info {
            text-align: center;
            font-size: 12px;
            color: #666;
            margin-top: 20px;
        }

        .footer-info a {
            color: #E20021;
        }

        /* Confirmation */
        .confirmation-message {
            text-align: center;
            padding: 40px 20px;
        }

        .confirmation-message h2 {
            font-size: 28px;
            color: #4CAF50;
            margin-bottom: 12px;
        }

        .confirmation-message p {
            font-size: 16px;
            color: #666;
        }

        .ticket-instructions {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 24px;
        }

        .ticket-instructions h3 {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 12px;
        }

        .step-icons {
            display: flex;
            justify-content: space-around;
            margin-top: 24px;
        }

        .step-icons .step {
            text-align: center;
            flex: 1;
        }

        .step-icons .step img {
            width: 60px;
            height: 60px;
            margin-bottom: 12px;
        }

        .step-icons .step p {
            font-size: 14px;
            color: #666;
        }

        .step-divider {
            width: 40px;
            height: 2px;
            background: #ddd;
            align-self: center;
        }

        /* Product Details Modal */
        .product-details-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 10000;
            justify-content: center;
            align-items: center;
        }

        .product-details-content {
            background: white;
            width: 90%;
            max-width: 600px;
            height: 90vh;
            border-radius: 12px;
            position: relative;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .product-details-content .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 20px;
            border-bottom: 1px solid #eee;
            background: white;
        }

        .back-to-modal,
        .close-product-details {
            background: none;
            border: none;
            font-size: 20px;
            cursor: pointer;
            padding: 8px;
            color: #333;
        }

        .product-scrollable-content {
            flex: 1;
            overflow-y: auto;
        }

        .product-main-image {
            width: 100%;
            height: 300px;
            overflow: hidden;
        }

        .product-main-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .product-main-image.placeholder-image {
            background: linear-gradient(135deg, #f5f5f5 0%, #e0e0e0 100%);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .product-main-image .image-placeholder {
            font-size: 120px;
            opacity: 0.7;
        }

        .product-variant-tabs {
            display: flex;
            gap: 12px;
            padding: 16px;
            overflow-x: auto;
        }

        .variant-tab {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            padding: 8px;
            border: 2px solid transparent;
            border-radius: 8px;
            cursor: pointer;
            background: none;
            min-width: 80px;
        }

        .variant-tab.active {
            border-color: #E20021;
        }

        .variant-tab img {
            width: 60px;
            height: 60px;
            border-radius: 8px;
            object-fit: cover;
        }

        .variant-tab .tab-placeholder {
            width: 60px;
            height: 60px;
            background: #f5f5f5;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
        }

        .variant-tab span {
            font-size: 12px;
            color: #333;
        }

        .product-details-info {
            padding: 20px;
        }

        .variant-content {
            display: none;
        }

        .variant-content.active {
            display: block;
        }

        .variant-content h2 {
            font-size: 24px;
            margin-bottom: 16px;
        }

        .variant-content p {
            font-size: 14px;
            color: #666;
            line-height: 1.6;
            margin-bottom: 20px;
        }

        .color-options h3 {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 12px;
        }

        .color-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 12px;
        }

        .color-option {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            padding: 8px;
            border: 2px solid transparent;
            border-radius: 8px;
        }

        .color-option.selected {
            border-color: #E20021;
        }

        .color-option img {
            width: 50px;
            height: 50px;
            border-radius: 8px;
            object-fit: cover;
        }

        .color-option span {
            font-size: 12px;
            color: #333;
        }

        .product-sticky-bottom {
            background: white;
            padding: 16px 20px;
            border-top: 1px solid #eee;
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .product-counter {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .product-counter .counter {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .product-counter .counter button {
            width: 32px;
            height: 32px;
            border: 1px solid #ddd;
            background: white;
            border-radius: 6px;
            cursor: pointer;
        }

        .product-counter .counter input {
            width: 40px;
            height: 32px;
            text-align: center;
            border: 1px solid #ddd;
            border-radius: 6px;
        }

        .product-sticky-bottom .add-to-cart-btn {
            flex: 1;
            padding: 14px 20px;
            background: #E20021;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .booking-page-content {
                padding: 10px;
                padding-top: 80px;
            }

            .booking-page-header h1 {
                font-size: 20px;
            }

            .booking-inner-container {
                padding: 16px;
            }

            .ticket-type {
                padding: 16px;
            }

            .current-price {
                font-size: 18px;
            }

            .current-total {
                font-size: 20px;
            }

            .cross-sell-section h2 {
                font-size: 18px;
            }

            .color-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        /* Hanbok Rental Info Modal Styles */
        .hanbok-info-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.6);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10001;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }

        .hanbok-info-modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .hanbok-info-modal {
            background: white;
            border-radius: 16px;
            max-width: 720px;
            width: 95%;
            max-height: 90vh;
            min-height: 80vh;
            display: flex;
            flex-direction: column;
            position: relative;
            transform: translateY(20px);
            transition: transform 0.3s ease;
        }

        .hanbok-info-modal-overlay.active .hanbok-info-modal {
            transform: translateY(0);
        }

        .hanbok-info-modal .close-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(0, 0, 0, 0.5);
            border: none;
            color: white;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            font-size: 20px;
            cursor: pointer;
            z-index: 10;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .hanbok-info-modal .close-btn:hover {
            background: rgba(0, 0, 0, 0.7);
        }

        .hanbok-modal-content {
            padding: 24px;
            overflow-y: auto;
            flex: 1;
        }

        .hanbok-info-header {
            text-align: center;
            margin-bottom: 28px;
        }

        .hanbok-header-image {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            object-fit: cover;
            margin-bottom: 16px;
            border: 3px solid #E20021;
        }

        .hanbok-info-header h2 {
            font-size: 22px;
            font-weight: 700;
            color: #333;
            margin: 0 0 8px 0;
        }

        .hanbok-info-header p {
            font-size: 14px;
            color: #666;
            margin: 0;
        }

        .hanbok-info-box {
            display: flex;
            gap: 16px;
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 16px;
            border: 1px solid #e9ecef;
        }

        .hanbok-info-box:last-of-type {
            margin-bottom: 0;
        }

        .info-box-icon {
            flex-shrink: 0;
            width: 52px;
            height: 52px;
            background: linear-gradient(135deg, #E20021 0%, #ff4757 100%);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
        }

        .info-box-content h3 {
            font-size: 16px;
            font-weight: 700;
            color: #333;
            margin: 0 0 12px 0;
        }

        .info-box-content p {
            font-size: 14px;
            color: #555;
            line-height: 1.6;
            margin: 0 0 8px 0;
        }

        .info-box-content ul {
            margin: 8px 0;
            padding-left: 18px;
        }

        .info-box-content ul li {
            font-size: 14px;
            color: #555;
            line-height: 1.6;
            margin-bottom: 4px;
        }

        .info-tip {
            background: #fff3cd;
            padding: 10px 12px;
            border-radius: 8px;
            font-size: 13px !important;
            color: #856404 !important;
            margin-top: 12px !important;
        }

        .hanbok-modal-footer {
            padding: 16px 24px;
            border-top: 1px solid #eee;
            display: flex;
            gap: 12px;
        }

        .hanbok-back-btn {
            flex: 0 0 auto;
            padding: 14px 24px;
            background: #f5f5f5;
            color: #333;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s ease;
        }

        .hanbok-back-btn:hover {
            background: #e0e0e0;
        }

        .hanbok-continue-btn {
            flex: 1;
            padding: 14px 24px;
            background: #E20021;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s ease;
        }

        .hanbok-continue-btn:hover {
            background: #cc0000;
        }

        /* Hanbok Order Summary Styles */
        .hanbok-order-summary {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid #e9ecef;
        }

        .hanbok-order-summary h3 {
            font-size: 16px;
            font-weight: 700;
            color: #333;
            margin: 0 0 16px 0;
        }

        .hanbok-order-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #e9ecef;
            gap: 12px;
        }

        .hanbok-order-item:last-child {
            border-bottom: none;
        }

        .hanbok-order-item-info {
            flex: 1;
            min-width: 0;
        }

        .hanbok-order-item-name {
            font-size: 14px;
            font-weight: 600;
            color: #333;
            margin-bottom: 4px;
        }

        .hanbok-order-item-meta {
            font-size: 12px;
            color: #666;
        }

        .hanbok-order-item-controls {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .hanbok-order-item-qty {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .hanbok-order-item-qty button {
            width: 28px;
            height: 28px;
            border: 1px solid #ddd;
            background: white;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .hanbok-order-item-qty button:hover {
            background: #f5f5f5;
            border-color: #E20021;
        }

        .hanbok-order-item-qty span {
            font-weight: 600;
            min-width: 20px;
            text-align: center;
        }

        .hanbok-order-item-qty .qty-label {
            font-size: 12px;
            color: #666;
            font-weight: 400;
        }

        .hanbok-order-item-price {
            font-size: 14px;
            font-weight: 600;
            color: #E20021;
            min-width: 70px;
            text-align: right;
        }

        /* Hanbok User Info Form */
        .hanbok-user-form {
            padding: 0;
        }

        .hanbok-user-form .form-group {
            margin-bottom: 20px;
        }

        .hanbok-user-form .form-group label {
            display: block;
            font-size: 14px;
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
        }

        .hanbok-user-form .form-group label .required {
            color: #E20021;
            font-weight: 600;
        }

        .hanbok-user-form .form-group label .optional {
            color: #888;
            font-weight: 400;
            font-size: 12px;
        }

        .hanbok-user-form .form-group input {
            width: 100%;
            padding: 12px 14px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.2s;
        }

        .hanbok-user-form .form-group input:focus {
            outline: none;
            border-color: #E20021;
        }

        .hanbok-user-form .info-text {
            display: flex;
            align-items: center;
            gap: 6px;
            margin-top: 6px;
            font-size: 12px;
            color: #666;
        }

        .hanbok-user-form .info-icon {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: #ddd;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            font-weight: 600;
            color: #666;
        }

        .cancellation-policy-section {
            background: #fff8e1;
            border: 1px solid #ffc107;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 20px;
        }

        .cancellation-policy-section p {
            margin: 0 0 10px 0;
            font-size: 14px;
        }

        .cancellation-policy-section ul {
            margin: 0;
            padding-left: 20px;
        }

        .cancellation-policy-section li {
            font-size: 13px;
            color: #666;
            margin-bottom: 6px;
        }

        .cancellation-policy-section li:last-child {
            margin-bottom: 0;
        }

        .terms-section {
            padding: 12px 0;
        }

        .terms-checkbox {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .terms-checkbox input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .terms-checkbox label {
            font-size: 14px;
            color: #333;
            cursor: pointer;
        }

        .hanbok-order-totals {
            padding-top: 12px;
            border-top: 2px solid #e9ecef;
        }

        .hanbok-subtotal,
        .hanbok-savings,
        .hanbok-total {
            display: flex;
            justify-content: space-between;
            padding: 6px 0;
        }

        .hanbok-savings span:last-child {
            color: #28a745;
            font-weight: 600;
        }

        .hanbok-total {
            padding-top: 12px;
            margin-top: 6px;
            border-top: 1px solid #e9ecef;
        }

        .hanbok-total span:first-child {
            font-size: 16px;
            font-weight: 700;
        }

        .hanbok-total span:last-child {
            font-size: 18px;
            font-weight: 700;
            color: #E20021;
        }

        /* Condensed Info Grid */
        .hanbok-condensed-info h4 {
            font-size: 14px;
            font-weight: 700;
            color: #333;
            margin: 0 0 12px 0;
        }

        .condensed-info-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin-bottom: 20px;
        }

        .condensed-info-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            background: #f8f9fa;
            border-radius: 10px;
            padding: 14px 10px;
            border: 1px solid #e9ecef;
        }

        .condensed-icon {
            width: 36px;
            height: 36px;
            background: linear-gradient(135deg, #E20021 0%, #ff4757 100%);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            margin-bottom: 10px;
        }

        .condensed-content strong {
            display: block;
            font-size: 12px;
            font-weight: 700;
            color: #333;
            margin-bottom: 4px;
        }

        .condensed-content span {
            font-size: 11px;
            color: #666;
            line-height: 1.3;
        }

        /* Hanbok Payment Section */
        .hanbok-payment-section {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 16px;
            border: 1px solid #e9ecef;
        }

        .hanbok-payment-section h4 {
            font-size: 14px;
            font-weight: 700;
            color: #333;
            margin: 0 0 12px 0;
        }

        .hanbok-payment-section .payment-methods {
            margin-bottom: 12px;
        }

        .hanbok-payment-section .card-logos {
            display: flex;
            gap: 12px;
            align-items: center;
            margin-bottom: 12px;
        }

        .hanbok-payment-section .alternative-payments {
            display: flex;
            gap: 12px;
        }

        .hanbok-payment-section .footer-info {
            font-size: 11px;
            color: #888;
            text-align: center;
        }

        @media (max-width: 768px) {
            .hanbok-info-modal {
                width: 95%;
                max-height: 85vh;
            }

            .hanbok-info-box {
                flex-direction: column;
                gap: 12px;
            }

            .info-box-icon {
                width: 44px;
                height: 44px;
            }

            .info-box-icon svg {
                width: 22px;
                height: 22px;
            }

            .hanbok-header-image {
                width: 100px;
                height: 100px;
            }

            .hanbok-info-header h2 {
                font-size: 18px;
            }

            .condensed-info-grid {
                grid-template-columns: 1fr;
            }

            .condensed-info-item {
                flex-direction: row;
                text-align: left;
                padding: 12px;
                gap: 12px;
            }

            .condensed-icon {
                margin-bottom: 0;
            }

            .hanbok-modal-footer {
                flex-direction: column;
            }

            .hanbok-back-btn {
                order: 2;
            }

            .hanbok-continue-btn {
                order: 1;
            }
        }
    </style>
</head>
<body class="template-page booking-page">
    <!-- Promo notification bar -->
    <div class="promo-notification-bar">
        <span> Claim your HITIGER discount upon your first reservation! ðŸšŒ ðŸ’¨ðŸ’¨</span>
        <button class="close-btn">âœ•</button>
    </div>
    
    <!-- Top notification bar -->
    <div class="notification-bar">
        <button class="mobile-menu-btn">
            <i class="fas fa-bars"></i>
        </button>
        <a href="#" class="directions">Directions to Gwanghwamun ticket office <img src="imgs/googleicon.png" style="width:25px; height:20px;"><img src="imgs/navericon.png" style="width:22px; height:20px;"></a>
        <div class="right-section">
            <div class="customer-service">
                <span>CUSTOMER SERVICE:</span> <span class="phone-number">02 777 6090</span>
            </div>
            <div class="language-selector">
                <button class="language-btn">
                    <img src="imgs/globe.svg" alt="Language" class="globe-icon">
                </button>
                <div class="language-dropdown">
                    <a href="#" data-lang="en">English</a>
                    <a href="#" data-lang="kr">í•œêµ­ì–´</a>
                </div>
            </div>
        </div>
    </div>

    <!-- Mobile Header -->
    <div class="mobile-header">
        <button class="mobile-menu-btn">â˜°</button>
	        <div class="logo">
	            <a href="/"><img src="imgs/redlogo-tigerbus.png" alt="Seoul City Tour Tiger Bus"></a>
	        </div>
        <div class="nav-buttons">
	            <a href="/booking" class="booking-btn">
                <img src="imgs/bookingicon.png" alt="Booking">
                BOOKING
            </a>
            <a href="#" class="login-btn">
                <img src="imgs/myaccounticon.png" alt="My Account">
                MY BOOKING
            </a>
        </div>
    </div>

    <style>
        /* Update mobile header styles */
        .mobile-header {
            background-color: white !important;
        }

        .mobile-header .logo {
            display: flex;
            align-items: center;
            height: 50px;
        }

        .mobile-header .logo img {
            height: 30px;
            width: auto;
            object-fit: contain;
            filter: none !important;
        }

        .mobile-header.light-background .logo img {
            filter: none !important;
        }
    </style>

    <!-- Navigation bar -->
    <nav class="main-nav">
        <ul class="nav-links">
	            <li><a href="/" class="home-logo"><img src="imgs/smalllogo.png" alt="Home" style="height: 35px; width: auto; display: block;"></a></li>
            <li><a href="#">Tours</a></li>
            <li><a href="map.html">Map</a></li>
            <li><a href="notices.html">Notices</a></li>
            <li><a href="blog.html">Discover</a></li>
            <li><a href="discounts.html">Discounts</a></li>
            <li><a href="inquiries.html">Inquiries</a></li>
        </ul>
        <div class="nav-buttons">
	            <a href="/booking" class="booking-btn">
                <img src="imgs/bookingicon.png" alt="Booking">
                BOOKING
            </a>
            <a href="my-booking.html" class="login-btn">
                <img src="imgs/myaccounticon.png" alt="My Account">
                MY BOOKING
            </a>
        </div>
    </nav>

    <!-- Main Booking Content -->
    <main class="booking-page-content">
        <div class="booking-page-container">
            <div class="booking-page-header">
                <h1>Book Your Tour</h1>
            </div>

            <!-- Step 1: Tour Selection -->
            <div class="booking-step-page active" id="step1">
                <div class="step-title-section">
                    <span class="step-number">1</span>
                    <span class="step-title">Select Your Tour</span>
                </div>
                <div class="booking-inner-container">
                    <!-- Tour Display -->
                    <div class="tour-display" id="tour-display">
                        <!-- Will be populated by JavaScript -->
                    </div>

                    <!-- Tour Selector -->
                    <div class="tour-selector">
                        <select id="tour-select">
                            <option value="tour01">Tour 01 Downtown Palace Namsan Course (Hop On, Hop Off)</option>
                            <option value="tour02">Tour 02 Panorama Course</option>
                            <option value="tour04">Tour 04 Night View Course (Non Stop)</option>
                        </select>
                    </div>

                    <!-- Tour Info Panel -->
                    <div class="tour-info-panel">
                        <div class="tour-info-content tour01-info active">
                            <div class="tour-info-row">
                                <ul>
                                    <li>Lorem ipsum dolor sit amet, consectetur adipiscing elit</li>
                                    <li>Sed do eiusmod tempor incididunt ut labore et dolore</li>
                                    <li>Ut enim ad minim veniam, quis nostrud exercitation</li>
                                    <li>Duis aute irure dolor in reprehenderit in voluptate</li>
                                </ul>
                                <div class="tour-map-btn-wrapper">
                                    <button class="tour-map-btn" data-tour="tour01">
                                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <polygon points="1 6 1 22 8 18 16 22 23 18 23 2 16 6 8 2 1 6"></polygon>
                                            <line x1="8" y1="2" x2="8" y2="18"></line>
                                            <line x1="16" y1="6" x2="16" y2="22"></line>
                                        </svg>
                                        Map
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="tour-info-content tour04-info">
                            <div class="tour-info-row">
                                <ul>
                                    <li>Excepteur sint occaecat cupidatat non proident sunt</li>
                                    <li>Nemo enim ipsam voluptatem quia voluptas sit aspernatur</li>
                                    <li>Neque porro quisquam est qui dolorem ipsum quia dolor</li>
                                    <li>Quis autem vel eum iure reprehenderit qui in ea voluptate</li>
                                </ul>
                                <div class="tour-map-btn-wrapper">
                                    <button class="tour-map-btn" data-tour="tour04">
                                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <polygon points="1 6 1 22 8 18 16 22 23 18 23 2 16 6 8 2 1 6"></polygon>
                                            <line x1="8" y1="2" x2="8" y2="18"></line>
                                            <line x1="16" y1="6" x2="16" y2="22"></line>
                                        </svg>
                                        Map
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="tour-info-content tour02-info">
                            <div class="tour-info-row">
                                <ul>
                                    <li>Panorama Course - scenic views of Seoul</li>
                                    <li>First Bus: 10:00AM, Last Bus: 5:00PM</li>
                                    <li>Interval: Every 45 minutes</li>
                                    <li>Total Course Time: 2 hours</li>
                                </ul>
                                <div class="tour-map-btn-wrapper">
                                    <button class="tour-map-btn" data-tour="tour02">
                                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <polygon points="1 6 1 22 8 18 16 22 23 18 23 2 16 6 8 2 1 6"></polygon>
                                            <line x1="8" y1="2" x2="8" y2="18"></line>
                                            <line x1="16" y1="6" x2="16" y2="22"></line>
                                        </svg>
                                        Map
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Tour Map Popup -->
                    <div class="tour-map-popup-overlay" id="tourMapPopup">
                        <div class="tour-map-popup">
                            <button class="tour-map-popup-close">&times;</button>
                            <div class="tour-map-content" id="tourMapContent">
                                <svg class="tour-map-icon" viewBox="0 0 24 24" fill="none" stroke="#D40004" stroke-width="1.5">
                                    <polygon points="1 6 1 22 8 18 16 22 23 18 23 2 16 6 8 2 1 6"></polygon>
                                    <line x1="8" y1="2" x2="8" y2="18"></line>
                                    <line x1="16" y1="6" x2="16" y2="22"></line>
                                </svg>
                                <p class="tour-map-label">Tour Map</p>
                            </div>
                        </div>
                    </div>

                    <!-- Date Selector -->
                    <div class="date-selector">
                        <div class="date-picker-wrapper">
                            <div class="date-picker-trigger" id="date-trigger">
                                <span class="selected-date">Select a date</span>
                                <svg class="calendar-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                                    <line x1="16" y1="2" x2="16" y2="6"></line>
                                    <line x1="8" y1="2" x2="8" y2="6"></line>
                                    <line x1="3" y1="10" x2="21" y2="10"></line>
                                </svg>
                            </div>
                            <div class="calendar-dropdown" id="calendar-dropdown">
                                <div class="calendar-header">
                                    <button class="prev-month" id="prev-month">â†</button>
                                    <span class="current-month" id="current-month">December 2025</span>
                                    <button class="next-month" id="next-month">â†’</button>
                                </div>
                                <div class="weekdays">
                                    <span>Sun</span>
                                    <span>Mon</span>
                                    <span>Tue</span>
                                    <span>Wed</span>
                                    <span>Thu</span>
                                    <span>Fri</span>
                                    <span>Sat</span>
                                </div>
                                <div class="days" id="calendar-days">
                                    <!-- Days will be populated by JavaScript -->
                                </div>
                                <div class="calendar-footer">
                                    <div class="availability-legend">
                                        <div class="legend-item">
                                            <span class="dot available"></span>
                                            <span>Available</span>
                                        </div>
                                        <div class="legend-item">
                                            <span class="dot sold-out"></span>
                                            <span>Sold Out</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Ticket Selection -->
                    <div class="ticket-selection">
                        <div class="ticket-type" data-type="adult">
                            <div class="ticket-info">
                                <div class="ticket-label">Adult</div>
                                <div class="age-range">Ages 19-64</div>
                            </div>
                            <div class="price-counter">
                                <div class="price">
                                    <span class="current-price" id="adult-price">$20.00</span>
                                    <span class="original-price" id="adult-original">$25.00</span>
                                </div>
                                <div class="counter">
                                    <button class="decrease" data-type="adult">-</button>
                                    <input type="text" value="0" readonly class="count" id="adult-count">
                                    <button class="increase" data-type="adult">+</button>
                                </div>
                            </div>
                        </div>
                        <div class="ticket-type" data-type="child">
                            <div class="ticket-info">
                                <div class="ticket-label">Child</div>
                                <div class="age-range">Ages 3-18</div>
                            </div>
                            <div class="price-counter">
                                <div class="price">
                                    <span class="current-price" id="child-price">$15.00</span>
                                    <span class="original-price" id="child-original">$20.00</span>
                                </div>
                                <div class="counter">
                                    <button class="decrease" data-type="child">-</button>
                                    <input type="text" value="0" readonly class="count" id="child-count">
                                    <button class="increase" data-type="child">+</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Total Summary -->
                    <div class="total-summary">
                        <div class="ticket-total">
                            <span class="total-label">Total</span>
                            <div class="total-price">
                                <span class="original-total" id="original-total">$0.00</span>
                                <span class="current-total" id="current-total">$0.00</span>
                            </div>
                        </div>
                    </div>

                    <!-- Cross-sell Section -->
                    <div class="cross-sell-section">
                        <h2>Enhance your Seoul experience</h2>
                        <p class="cross-sell-subtitle">Add these popular items to your booking</p>

                        <!-- Category Tabs -->
                        <div class="category-tabs">
                            <button class="category-tab active" data-category="products">Products</button>
                            <button class="category-tab" data-category="experiences">Experiences</button>
                            <button class="category-tab" data-category="services">Services</button>
                        </div>

                        <!-- Products Category - Physical items -->
                        <div class="products-grid active" data-category="products">
                            <div class="cross-sell-carousel">
                                <div class="cross-sell-slide active">
                                    <div class="product-card upsell-card" data-product-id="kwangjuyo" data-type="physical" data-price="25" data-original-price="35" data-name="Kwangjuyo">
                                        <div class="product-badge">Best Seller</div>
                                        <div class="product-image">
                                            <img src="imgs/kwangjuyo.webp" alt="Kwangjuyo">
                                        </div>
                                        <div class="product-info">
                                            <h3>Kwangjuyo</h3>
                                            <p>Experience the elegance of traditional Korean ceramics with Kwangjuyo's exquisite collection.</p>
                                            <div class="upsell-pricing">
                                                <span class="upsell-current-price">$25.00 USD</span>
                                                <span class="upsell-original-price">$35.00 USD</span>
                                                <span class="discount-badge">29% OFF</span>
                                            </div>
                                            <button class="view-btn">View Details</button>
                                        </div>
                                        <div class="product-incompatible-label">To book this, please create another booking with Tour 01, Tour 02 or Tour 04</div>
                                    </div>
                                </div>
                                <button class="cross-sell-nav prev">â€¹</button>
                                <button class="cross-sell-nav next">â€º</button>
                            </div>
                            <div class="cross-sell-dots">
                                <span class="dot active" data-index="0"></span>
                            </div>
                        </div>

                        <!-- Experiences Category - Scheduled and validity pass items -->
                        <div class="products-grid" data-category="experiences">
                            <div class="cross-sell-carousel">
                                <div class="cross-sell-slide active">
                                    <div class="product-card upsell-card" data-product-id="sejong-backstage" data-type="scheduled" data-price="8" data-original-price="12" data-adult-price="8" data-child-price="5" data-name="Backstage Pass Sejong Centre">
                                        <div class="product-badge">Exclusive</div>
                                        <div class="product-image">
                                            <img src="./imgs/sejong-addon.png" alt="Backstage Pass Sejong Centre">
                                        </div>
                                        <div class="product-info">
                                            <h3>Backstage Pass Sejong Centre</h3>
                                            <p>Go behind the scenes at Korea's premier performing arts venue with exclusive backstage access.</p>
                                            <div class="upsell-pricing">
                                                <span class="upsell-current-price">$8.00 USD</span>
                                            </div>
                                            <div class="type-indicator scheduled">Scheduled Experience</div>
                                            <button class="view-btn">View Details</button>
                                        </div>
                                        <div class="product-incompatible-label">To book this, please create another booking with Tour 01</div>
                                    </div>
                                </div>
                                <div class="cross-sell-slide">
                                    <div class="product-card upsell-card" data-product-id="museum-pass" data-type="validityPass" data-price="25" data-original-price="35" data-adult-price="25" data-child-price="15" data-valid-until="2025-06-30" data-name="Museum Pass">
                                        <div class="product-badge">Popular</div>
                                        <div class="product-image">
                                            <img src="./imgs/monet-addon.png" alt="Museum Pass">
                                        </div>
                                        <div class="product-info">
                                            <h3>Museum Pass</h3>
                                            <p>Access to major museums in Seoul. Valid for multiple entries during the validity period.</p>
                                            <div class="upsell-pricing">
                                                <span class="upsell-current-price">$25.00 USD</span>
                                                <span class="upsell-original-price">$35.00 USD</span>
                                                <span class="discount-badge">29% OFF</span>
                                            </div>
                                            <div class="type-indicator validity">Valid until Jun 30, 2025</div>
                                            <button class="view-btn">View Details</button>
                                        </div>
                                        <div class="product-incompatible-label">To book this, please create another booking with Tour 01</div>
                                    </div>
                                </div>
                                <div class="cross-sell-slide">
                                    <div class="product-card upsell-card" data-product-id="han-river-cruise" data-type="cruise" data-price="25" data-original-price="35" data-adult-price="25" data-child-price="18" data-name="Han River Cruise">
                                        <div class="product-badge">Popular</div>
                                        <div class="product-image">
                                            <img src="imgs/daycruise.png" alt="Han River Cruise">
                                        </div>
                                        <div class="product-info">
                                            <h3>Han River Cruise</h3>
                                            <p>Scenic cruise along the Han River with stunning views of Seoul's skyline. Choose from Day, Sunset, or Night cruises.</p>
                                            <div class="upsell-pricing">
                                                <span class="upsell-current-price">From $25.00 USD</span>
                                                <span class="upsell-original-price">$35.00 USD</span>
                                                <span class="discount-badge">29% OFF</span>
                                            </div>
                                            <div class="type-indicator scheduled">Choose Cruise Type</div>
                                            <button class="view-btn">View Details</button>
                                        </div>
                                        <div class="product-incompatible-label">To book this, please create another booking with Tour 02</div>
                                    </div>
                                </div>
                                <button class="cross-sell-nav prev">â€¹</button>
                                <button class="cross-sell-nav next">â€º</button>
                            </div>
                            <div class="cross-sell-dots">
                                <span class="dot active" data-index="0"></span>
                                <span class="dot" data-index="1"></span>
                                <span class="dot" data-index="2"></span>
                            </div>
                        </div>

                        <!-- Services Category -->
                        <div class="products-grid" data-category="services">
                            <div class="cross-sell-carousel">
                                <div class="cross-sell-slide active">
                                    <div class="product-card upsell-card" data-product-id="hanbok-rental" data-type="scheduled" data-price="20" data-original-price="30" data-adult-price="20" data-child-price="12" data-name="Hanbok Rental">
                                        <div class="product-badge">Popular</div>
                                        <div class="product-image">
                                            <img src="./imgs/hanbok-addon.png" alt="Hanbok Rental">
                                        </div>
                                        <div class="product-info">
                                            <h3>Hanbok Rental</h3>
                                            <p>Traditional Korean dress rental. Includes accessories and photo opportunities at scenic locations.</p>
                                            <div class="upsell-pricing">
                                                <span class="upsell-current-price">$20.00 USD</span>
                                                <span class="upsell-original-price">$30.00 USD</span>
                                                <span class="discount-badge">33% OFF</span>
                                            </div>
                                            <button class="view-btn">View Details</button>
                                        </div>
                                        <div class="product-incompatible-label">To book this, please create another booking with a compatible tour</div>
                                    </div>
                                </div>
                                <button class="cross-sell-nav prev">â€¹</button>
                                <button class="cross-sell-nav next">â€º</button>
                            </div>
                            <div class="cross-sell-dots">
                                <span class="dot active" data-index="0"></span>
                            </div>
                        </div>
                    </div>

                    <!-- Cancellation Info -->
                    <div class="cancellation-info">
                        <h3>Cancellation / Refund Information</h3>
                        <div class="refund-rates">
                            <p>â€¢ 100% refund if cancelled 3 days before boarding</p>
                            <p>â€¢ 90% refund if cancelled 2 days before boarding</p>
                            <p>â€¢ 80% refund if cancelled 1 day before boarding</p>
                            <p>â€¢ 70% refund if cancelled on the day of boarding</p>
                        </div>
                        <p class="night-tour-warning">* No refunds are available for cancellations after 12:00 PM on the day of the night tour</p>
                    </div>

                    <button class="continue-btn" id="continue-to-step2">Continue</button>
                </div>
            </div>

            <!-- Step 2: User Information -->
            <div class="booking-step-page" id="step2">
                <div class="step-title-section">
                    <span class="step-number">2</span>
                    <span class="step-title">Your Information</span>
                </div>
                <div class="booking-inner-container">
                    <button class="back-btn" id="back-to-step1">â† Back</button>

                    <!-- Order Summary for Step 2 -->
                    <div class="order-summary" id="step2-order-summary">
                        <h4>Order Summary</h4>

                        <div class="order-section" id="step2-tickets-section">
                            <div class="order-section-title">Tour Tickets</div>
                            <div class="order-tour-date" id="step2-order-tour-date"></div>
                            <div id="step2-order-tickets">
                                <!-- Tickets will be populated by JavaScript -->
                            </div>
                        </div>

                        <div class="order-section" id="step2-addons-section" style="display: none;">
                            <div class="order-section-title">Add-ons</div>
                            <div id="step2-order-addons">
                                <!-- Add-ons will be populated by JavaScript -->
                            </div>
                        </div>

                        <div class="order-totals">
                            <div class="subtotal">
                                <span>Subtotal</span>
                                <span id="step2-order-subtotal">$0.00</span>
                            </div>
                            <div class="savings" id="step2-order-savings-row" style="display: none;">
                                <span>You Save</span>
                                <span id="step2-order-savings">-$0.00</span>
                            </div>
                            <div class="total">
                                <span>Total</span>
                                <span id="step2-order-total">$0.00</span>
                            </div>
                        </div>
                    </div>

                    <div class="user-info-form">
                        <div class="form-group">
                            <label for="full-name">Full Name *</label>
                            <input type="text" id="full-name" placeholder="Enter your full name">
                        </div>
                        <div class="form-group">
                            <label for="email">Email Address *</label>
                            <input type="email" id="email" placeholder="Enter your email">
                            <div class="info-text">
                                <span class="info-icon">i</span>
                                <span>Your ticket will be sent to this email</span>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="phone">Phone Number *</label>
                            <input type="tel" id="phone" placeholder="Enter your phone number">
                        </div>

                        <div class="cancellation-policy-section">
                            <p><strong>Cancellation & Refund Policy</strong></p>
                            <ul>
                                <li>100% refund for cancellations made 24 hours before the tour</li>
                                <li>50% refund for cancellations made 12 hours before the tour</li>
                                <li>No refund for cancellations made less than 12 hours before the tour</li>
                                <li>Night View Course (Tour 04) tickets are non-refundable on the day of the tour</li>
                                <li>Refund processing may take 3-5 business days</li>
                                <li>All times are based on local Seoul time (KST)</li>
                            </ul>
                        </div>

                        <div class="terms-section">
                            <div class="terms-text-box">
                                <p><strong>Terms and Conditions</strong></p>
                                <p>By proceeding with this booking, you agree to our terms of service and cancellation policy. Tickets are non-transferable and must be used on the selected date. Please arrive at least 15 minutes before departure time.</p>
                            </div>
                            <div class="terms-checkbox">
                                <input type="checkbox" id="terms-agree">
                                <label for="terms-agree">I agree to the Terms and Conditions</label>
                            </div>
                            <div class="terms-checkbox">
                                <input type="checkbox" id="marketing-agree">
                                <label for="marketing-agree">I agree to receive marketing communications (optional)</label>
                            </div>
                        </div>
                    </div>

                    <button class="continue-btn" id="continue-to-step3">Continue to Payment</button>
                </div>
            </div>

            <!-- Step 3: Payment -->
            <div class="booking-step-page" id="step3">
                <div class="step-title-section">
                    <span class="step-number">3</span>
                    <span class="step-title">Payment</span>
                </div>
                <div class="booking-inner-container">
                    <button class="back-btn" id="back-to-step2">â† Back</button>

                    <!-- Order Summary -->
                    <div class="order-summary">
                        <h4>Order Summary</h4>

                        <div class="order-section" id="tickets-section">
                            <div class="order-section-title">Tour Tickets</div>
                            <div class="order-tour-date" id="order-tour-date"></div>
                            <div id="order-tickets">
                                <!-- Tickets will be populated by JavaScript -->
                            </div>
                        </div>

                        <div class="order-section" id="addons-section" style="display: none;">
                            <div class="order-section-title">Add-ons</div>
                            <div id="order-addons">
                                <!-- Add-ons will be populated by JavaScript -->
                            </div>
                        </div>

                        <div class="order-totals">
                            <div class="subtotal">
                                <span>Subtotal</span>
                                <span id="order-subtotal">$0.00</span>
                            </div>
                            <div class="savings" id="order-savings-row" style="display: none;">
                                <span>You Save</span>
                                <span id="order-savings">-$0.00</span>
                            </div>
                            <div class="total">
                                <span>Total</span>
                                <span id="order-total">$0.00</span>
                            </div>
                        </div>
                    </div>

                    <!-- Payment Methods -->
                    <div class="payment-methods">
                        <div class="credit-card-section">
                            <h4>Credit/Debit Card</h4>
                            <div class="card-logos">
                                <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/5/5e/Visa_Inc._logo.svg/2560px-Visa_Inc._logo.svg.png" alt="Visa">
                                <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/2/2a/Mastercard-logo.svg/1280px-Mastercard-logo.svg.png" alt="Mastercard">
                                <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/f/fa/American_Express_logo_%282018%29.svg/1200px-American_Express_logo_%282018%29.svg.png" alt="American Express">
                            </div>
                        </div>

                        <div class="alternative-payments">
                            <div class="payment-option">
                                <img src="https://developers.kakao.com/tool/resource/static/img/button/pay/payment_icon_yellow_medium.png" alt="KakaoPay">
                                <span>KakaoPay</span>
                            </div>
                            <div class="payment-option">
                                <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/2/23/Naver_Logotype.svg/2560px-Naver_Logotype.svg.png" alt="NaverPay">
                                <span>NaverPay</span>
                            </div>
                        </div>
                    </div>

                    <button class="continue-btn" id="make-payment">Make Payment</button>

                    <div class="footer-info">
                        Secured by Eximbay | <a href="#">Terms & Conditions</a>
                    </div>
                </div>
            </div>

            <!-- Step 4: Confirmation -->
            <div class="booking-step-page" id="step4">
                <div class="step-title-section">
                    <span class="step-number">âœ“</span>
                    <span class="step-title">Booking Confirmed</span>
                </div>
                <div class="booking-inner-container">
                    <div class="confirmation-message">
                        <h2>ðŸŽ‰ Your ticket is ready!</h2>
                        <p>We've sent your ticket to your email.</p>
                    </div>

                    <div class="ticket-instructions">
                        <h3>How to get your physical ticket</h3>
                        <p>Visit any of our ticket offices with your booking reference:</p>

                        <div class="step-icons">
                            <div class="step">
                                <img src="imgs/1.svg" alt="Claim Ticket">
                                <p>Claim your physical ticket at the ticket office</p>
                            </div>
                            <span class="step-divider"></span>
                            <div class="step">
                                <img src="imgs/2.svg" alt="Print at Kiosk">
                                <p>Print at Kiosk</p>
                            </div>
                            <span class="step-divider"></span>
                            <div class="step">
                                <img src="imgs/3.svg" alt="Visit Counter">
                                <p>Visit Counter</p>
                            </div>
                        </div>
                    </div>

	                    <button class="continue-btn" onclick="window.location.href='/'">Back to Home</button>
                </div>
            </div>
        </div>
    </main>

    <!-- Floating Cart Bar - Full Width Desktop -->
    <div class="upsell-cart-bar" id="upsell-cart-bar">
        <div class="cart-bar-content">
            <div class="cart-bar-left">
                <div class="cart-bar-icon">
                    <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="9" cy="21" r="1"></circle>
                        <circle cx="20" cy="21" r="1"></circle>
                        <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
                    </svg>
                    <span class="cart-badge" id="cart-count">0</span>
                </div>
                <div class="cart-bar-info">
                    <span class="cart-bar-items" id="cart-items-text">0 items added</span>
                    <span class="cart-bar-total" id="cart-total">$0.00</span>
                </div>
            </div>
            <div class="cart-bar-right">
                <button class="view-cart-btn" id="view-cart-btn">
                    View Cart
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="6 9 12 15 18 9"></polyline>
                    </svg>
                </button>
                <button class="view-cart-btn" id="continue-booking-btn" style="margin-left: 8px;">
                    Continue Booking
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="9 18 15 12 9 6"></polyline>
                    </svg>
                </button>
            </div>
        </div>
        <div class="cart-bar-expanded" id="cart-expanded">
            <div class="cart-expanded-header">
                <h4>Your Add-ons</h4>
                <button class="collapse-cart-btn" id="collapse-cart">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="18 15 12 9 6 15"></polyline>
                    </svg>
                </button>
            </div>
            <div class="cart-items-list" id="cart-items-list">
                <!-- Cart items will be populated by JavaScript -->
            </div>
            <div class="cart-expanded-footer">
                <div class="cart-savings" id="cart-savings-row" style="display: none;">
                    <span>You Save</span>
                    <span id="cart-savings">$0.00</span>
                </div>
                <div class="cart-total-row">
                    <span>Add-ons Total</span>
                    <span id="cart-total-expanded">$0.00</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Product Details Modal -->
    <div class="product-details-modal" id="product-details-modal">
        <div class="product-details-content">
            <div class="modal-header">
                <button class="back-to-modal" id="close-product-modal">â†</button>
                <h3 id="product-modal-title">Product Details</h3>
                <button class="close-product-details" id="close-product-details">Ã—</button>
            </div>
            <div class="product-scrollable-content">
                <div class="product-main-image" id="product-main-image">
                    <img src="" alt="Product Image" id="product-image">
                </div>
                <div class="product-variant-tabs" id="product-variant-tabs">
                    <!-- Variant tabs will be populated by JavaScript -->
                </div>
                <div class="product-details-info" id="product-details-info">
                    <!-- Variant content will be populated by JavaScript -->
                </div>
            </div>
            <div class="product-sticky-bottom">
                <div class="product-counter">
                    <div class="counter">
                        <button class="decrease" id="product-decrease">-</button>
                        <input type="text" value="1" readonly id="product-quantity">
                        <button class="increase" id="product-increase">+</button>
                    </div>
                </div>
                <button class="add-to-cart-btn" id="add-to-cart-btn">Add to Cart - $0.00</button>
            </div>
        </div>
    </div>

    <!-- Footer Section -->
    <footer class="footer">
        <div class="footer-content">
            <!-- Left Section -->
            <div class="footer-left">
                <div class="footer-logo">
                    <img src="imgs/redlogo-tigerbus.png" alt="Tiger Bus Logo">
                </div>
                <div class="footer-info">
                    <p>302, 135-7, Sejong-daero, Jung-gu, Seoul / Jinyong Kil, CEO of Seoul City Tour Bus Co., Ltd.</p>
                    <p>Business registration number 104-81-27542</p>
                    <p>Telecommunication sales report number 2005-Jung-gu, Seoul-03675</p>
                </div>
            </div>

            <!-- Middle Section -->
            <div class="footer-nav">
                <ul>
                    <li><a href="privacy-policy.html">Privacy Policy</a></li>
                    <li><a href="about-us.html">About Us</a></li>
                    <li><a href="business-inquiry.html">Business Inquiry</a></li>
                </ul>
            </div>

            <!-- Right Section -->
            <div class="footer-right">
                <div class="social-links">
                    <a href="#" class="social-icon">
                        <img src="imgs/footericon-1.png" alt="Instagram">
                    </a>
                    <a href="#" class="social-icon">
                        <img src="imgs/footericon-2.png" alt="Visit Seoul">
                    </a>
                    <a href="#" class="social-icon">
                        <img src="imgs/footericon-3.png" alt="Blog">
                    </a>
                </div>
                <div class="contact-info">
                    <p class="footer-contact-label">Gwanghwamun Main Office Customer Inquiries</p>
                    <p class="footer-phone-number">02-777-6090</p>
                </div>
            </div>
        </div>
        
        <div class="footer-bottom">
            <div class="footer-info">
                <!-- Footer info is already in the left section -->
            </div>
            <div class="footer-illustration">
                <img src="imgs/footerimg.png" alt="Seoul City Illustration">
            </div>
        </div>
    </footer>

    <!-- Mobile Menu -->
    <div class="mobile-menu">
        <button class="mobile-menu-close">Ã—</button>
        <ul class="mobile-menu-links">
            <li><a href="#">Trips</a></li>
            <li><a href="map.html">Map</a></li>
            <li><a href="notices.html">Notice</a></li>
            <li><a href="discounts.html">Discounts</a></li>
            <li><a href="blog.html">Blog</a></li>
            <li><a href="inquiries.html">Inquiries</a></li>
	            <li><a href="/booking">Booking</a></li>
        </ul>
        <div class="logo">
	            <a href="/">
                <img src="imgs/logo.svg" alt="Seoul City Tour Tiger Bus">
            </a>
        </div>
    </div>

    <!-- Hanbok Rental Info Modal -->
    <div class="hanbok-info-modal-overlay" id="hanbokInfoModal">
        <div class="hanbok-info-modal">
            <button class="close-btn" id="closeHanbokInfo">&times;</button>
            <div class="hanbok-modal-content">
                <!-- Step 1: Important Information -->
                <div class="hanbok-step" id="hanbokStep1">
                    <div class="hanbok-info-header">
                        <img src="./imgs/hanbok-addon.png" alt="Hanbok Rental" class="hanbok-header-image">
                        <h2>Hanbok Rental - Important Information</h2>
                        <p>Please review the following information to make the most of your Hanbok experience</p>
                    </div>

                    <!-- Info Box 1: How to Get There -->
                    <div class="hanbok-info-box">
                        <div class="info-box-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                                <circle cx="12" cy="10" r="3"></circle>
                            </svg>
                        </div>
                        <div class="info-box-content">
                            <h3>How to Get There</h3>
                            <p><strong>Address:</strong> 23 Bukchon-ro 11-gil, Jongno-gu, Seoul</p>
                            <p><strong>Subway:</strong> Anguk Station (Line 3), Exit 2 - 5 min walk</p>
                            <p><strong>Nearby Landmarks:</strong> Bukchon Hanok Village, Gyeongbokgung Palace</p>
                            <p class="info-tip">ðŸ’¡ Look for the traditional hanok building with the pink sign!</p>
                        </div>
                    </div>

                    <!-- Info Box 2: How to Confirm Reservation -->
                    <div class="hanbok-info-box">
                        <div class="info-box-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                                <line x1="16" y1="2" x2="16" y2="6"></line>
                                <line x1="8" y1="2" x2="8" y2="6"></line>
                                <line x1="3" y1="10" x2="21" y2="10"></line>
                                <path d="M9 16l2 2 4-4"></path>
                            </svg>
                        </div>
                        <div class="info-box-content">
                            <h3>How to Confirm Your Reservation</h3>
                            <p>After completing your booking, you will receive:</p>
                            <ul>
                                <li>A confirmation email with your reservation details</li>
                                <li>A QR code to present at the rental shop</li>
                                <li>Contact details for the rental shop</li>
                            </ul>
                            <p><strong>Check-in Time:</strong> Please arrive 15 minutes before your scheduled time</p>
                            <p class="info-tip">ðŸ“§ Save your confirmation email - you'll need it at the shop!</p>
                        </div>
                    </div>

                    <!-- Info Box 3: How to Use & Returns -->
                    <div class="hanbok-info-box">
                        <div class="info-box-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <circle cx="12" cy="12" r="10"></circle>
                                <polyline points="12 6 12 12 16 14"></polyline>
                            </svg>
                        </div>
                        <div class="info-box-content">
                            <h3>How to Use the Rental Service & Returns</h3>
                            <p><strong>Rental Period:</strong> 4 hours from check-in time</p>
                            <p><strong>What's Included:</strong></p>
                            <ul>
                                <li>Traditional Hanbok outfit (top + skirt/pants)</li>
                                <li>Hair accessories and traditional bag</li>
                                <li>Secure locker for your belongings</li>
                                <li>Basic hairstyling assistance</li>
                            </ul>
                            <p><strong>Return Policy:</strong> Please return your Hanbok by the scheduled time to avoid late fees ($10/hour)</p>
                            <p class="info-tip">ðŸ“¸ Staff can help you take photos in the best spots nearby!</p>
                        </div>
                    </div>
                </div>

                <!-- Step 2: Review Order (Editable) -->
                <div class="hanbok-step" id="hanbokStep2" style="display: none;">
                    <div class="hanbok-info-header">
                        <img src="./imgs/hanbok-addon.png" alt="Hanbok Rental" class="hanbok-header-image">
                        <h2>Review Your Order</h2>
                        <p>Adjust quantities if needed</p>
                    </div>

                    <!-- Editable Order Summary Section -->
                    <div class="hanbok-order-summary" id="hanbokOrderSummary">
                        <h3>Your Order</h3>
                        <div class="hanbok-order-items" id="hanbokOrderItems">
                            <!-- Will be populated by JavaScript with editable quantities -->
                        </div>
                        <div class="hanbok-order-totals">
                            <div class="hanbok-subtotal">
                                <span>Subtotal</span>
                                <span id="hanbokSubtotal">$0.00</span>
                            </div>
                            <div class="hanbok-savings" id="hanbokSavingsRow" style="display: none;">
                                <span>You Save</span>
                                <span id="hanbokSavings">-$0.00</span>
                            </div>
                            <div class="hanbok-total">
                                <span>Total</span>
                                <span id="hanbokTotal">$0.00</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Step 3: Customer Information -->
                <div class="hanbok-step" id="hanbokStep3" style="display: none;">
                    <div class="hanbok-info-header">
                        <img src="./imgs/hanbok-addon.png" alt="Hanbok Rental" class="hanbok-header-image">
                        <h2>Enter Your Information</h2>
                        <p>Please provide your details for the booking</p>
                    </div>

                    <form class="user-info-form hanbok-user-form" id="hanbokUserInfoForm">
                        <div class="form-group">
                            <label>Name <span class="required">*</span></label>
                            <input type="text" placeholder="Enter your full name" id="hanbokUserName" required>
                        </div>
                        <div class="form-group">
                            <label>Email <span class="required">*</span></label>
                            <input type="email" placeholder="Enter your email" id="hanbokUserEmail" required>
                            <div class="info-text">
                                <span class="info-icon">i</span>
                                Your confirmation will be sent to this email
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Phone <span class="optional">(optional)</span></label>
                            <input type="tel" placeholder="Enter your phone number" id="hanbokUserPhone">
                        </div>

                        <div class="cancellation-policy-section">
                            <p><strong>Cancellation & Refund Policy</strong></p>
                            <ul>
                                <li>100% refund for cancellations made 24 hours before the scheduled time</li>
                                <li>50% refund for cancellations made 12 hours before</li>
                                <li>No refund for cancellations made less than 12 hours before</li>
                            </ul>
                        </div>

                        <div class="terms-section">
                            <div class="terms-checkbox">
                                <input type="checkbox" id="hanbokTerms">
                                <label for="hanbokTerms">I agree to the Terms & Conditions</label>
                            </div>
                        </div>
                    </form>
                </div>

                <!-- Step 4: Final Order Summary & Payment -->
                <div class="hanbok-step" id="hanbokStep4" style="display: none;">
                    <div class="hanbok-info-header">
                        <img src="./imgs/hanbok-addon.png" alt="Hanbok Rental" class="hanbok-header-image">
                        <h2>Confirm & Pay</h2>
                        <p>Review your final order and complete payment</p>
                    </div>

                    <!-- Final Order Summary (Read-only) -->
                    <div class="hanbok-order-summary hanbok-final-summary" id="hanbokFinalOrderSummary">
                        <h3>Order Summary</h3>
                        <div class="hanbok-order-items" id="hanbokFinalOrderItems">
                            <!-- Will be populated by JavaScript (read-only) -->
                        </div>
                        <div class="hanbok-order-totals">
                            <div class="hanbok-subtotal">
                                <span>Subtotal</span>
                                <span id="hanbokFinalSubtotal">$0.00</span>
                            </div>
                            <div class="hanbok-savings" id="hanbokFinalSavingsRow" style="display: none;">
                                <span>You Save</span>
                                <span id="hanbokFinalSavings">-$0.00</span>
                            </div>
                            <div class="hanbok-total">
                                <span>Total</span>
                                <span id="hanbokFinalTotal">$0.00</span>
                            </div>
                        </div>
                    </div>

                    <!-- Condensed Info Boxes -->
                    <div class="hanbok-condensed-info">
                        <h4>Important Reminders</h4>
                        <div class="condensed-info-grid">
                            <div class="condensed-info-item">
                                <div class="condensed-icon">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                                        <circle cx="12" cy="10" r="3"></circle>
                                    </svg>
                                </div>
                                <div class="condensed-content">
                                    <strong>Location</strong>
                                    <span>Anguk Station Exit 2, 5 min walk</span>
                                </div>
                            </div>
                            <div class="condensed-info-item">
                                <div class="condensed-icon">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                                        <line x1="16" y1="2" x2="16" y2="6"></line>
                                        <line x1="8" y1="2" x2="8" y2="6"></line>
                                        <line x1="3" y1="10" x2="21" y2="10"></line>
                                    </svg>
                                </div>
                                <div class="condensed-content">
                                    <strong>Confirmation</strong>
                                    <span>Check email for QR code</span>
                                </div>
                            </div>
                            <div class="condensed-info-item">
                                <div class="condensed-icon">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <circle cx="12" cy="12" r="10"></circle>
                                        <polyline points="12 6 12 12 16 14"></polyline>
                                    </svg>
                                </div>
                                <div class="condensed-content">
                                    <strong>Return Time</strong>
                                    <span>Return before 9:00 PM</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Payment Methods -->
                    <div class="hanbok-payment-section">
                        <h4>Payment Method</h4>
                        <div class="payment-methods">
                            <div class="card-logos">
                                <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/5/5e/Visa_Inc._logo.svg/2560px-Visa_Inc._logo.svg.png" alt="Visa" style="height: 24px; width: auto;">
                                <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/2/2a/Mastercard-logo.svg/1280px-Mastercard-logo.svg.png" alt="Mastercard" style="height: 24px; width: auto;">
                                <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/f/fa/American_Express_logo_%282018%29.svg/1200px-American_Express_logo_%282018%29.svg.png" alt="American Express" style="height: 24px; width: auto;">
                            </div>
                            <div class="alternative-payments">
                                <img src="https://developers.kakao.com/tool/resource/static/img/button/pay/payment_icon_yellow_medium.png" alt="KakaoPay" style="height: 24px; width: auto;">
                                <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/2/23/Naver_Logotype.svg/2560px-Naver_Logotype.svg.png" alt="NaverPay" style="height: 24px; width: auto;">
                            </div>
                        </div>
                        <div class="footer-info">Secured by Eximbay</div>
                    </div>
                </div>
            </div>

            <!-- Step 1 Footer -->
            <div class="hanbok-modal-footer" id="hanbokStep1Footer">
                <button class="hanbok-continue-btn" id="hanbokContinueToStep2Btn">Continue</button>
            </div>

            <!-- Step 2 Footer -->
            <div class="hanbok-modal-footer" id="hanbokStep2Footer" style="display: none;">
                <button class="hanbok-back-btn" id="hanbokBackToStep1Btn">Back</button>
                <button class="hanbok-continue-btn" id="hanbokContinueToStep3Btn">Continue</button>
            </div>

            <!-- Step 3 Footer -->
            <div class="hanbok-modal-footer" id="hanbokStep3Footer" style="display: none;">
                <button class="hanbok-back-btn" id="hanbokBackToStep2Btn">Back</button>
                <button class="hanbok-continue-btn" id="hanbokContinueToStep4Btn">Continue</button>
            </div>

            <!-- Step 4 Footer -->
            <div class="hanbok-modal-footer" id="hanbokStep4Footer" style="display: none;">
                <button class="hanbok-back-btn" id="hanbokBackToStep3Btn">Back</button>
                <button class="hanbok-continue-btn" id="hanbokMakePaymentBtn">Make Payment</button>
            </div>
        </div>
    </div>

    <!-- Note: Not loading script.js as booking page has its own complete JavaScript -->
    <script>
        // ============================================
        // BOOKING PAGE JAVASCRIPT
        // ============================================

        // ============================================
        // ADD-ON TYPE DEFINITIONS & VALIDATION LOGIC
        // ============================================
        // Types: 'physical' | 'scheduled' | 'validityPass'
        // physical: size + color + qty >= 1 (no date)
        // scheduled: date + (adult + child >= 1)
        // validityPass: (adult + child >= 1), NO date, has validUntil

        /**
         * Validates add-on selection based on type
         * @param {Object} product - Product data with type
         * @param {Object} selections - User selections {variant, color, quantity, date, adultQty, childQty}
         * @returns {boolean} - Whether selection is valid for add-to-cart
         */
        function canAddToCart(product, selections) {
            const { type } = product;

            if (type === 'physical') {
                // Physical products: variant/size + color (if applicable) + qty >= 1
                const hasVariant = selections.variant !== null && selections.variant !== undefined;
                const hasColor = !product.colors || (selections.color !== null && selections.color !== undefined);
                const hasQuantity = (selections.quantity || 0) >= 1;
                return hasVariant && hasColor && hasQuantity;
            }

            if (type === 'scheduled') {
                // Scheduled experiences: date required + time (if available) + (adult + child >= 1)
                const hasDate = selections.date !== null && selections.date !== undefined && selections.date !== '';
                const hasTickets = ((selections.adultQty || 0) + (selections.childQty || 0)) >= 1;
                // If product has time slots, require time selection
                const requiresTime = product.availableTimes && product.availableTimes.length > 0;
                const hasTime = !requiresTime || (selections.time !== null && selections.time !== undefined && selections.time !== '');
                return hasDate && hasTime && hasTickets;
            }

            if (type === 'validityPass') {
                // Validity-based pass: NO date required, just (adult + child >= 1)
                const hasTickets = ((selections.adultQty || 0) + (selections.childQty || 0)) >= 1;
                return hasTickets;
            }

            // Default: require quantity >= 1
            return (selections.quantity || 0) >= 1;
        }

        /**
         * Builds the cart item payload based on add-on type
         * @param {Object} product - Product data
         * @param {Object} selections - User selections
         * @returns {Object} - Cart item payload
         */
        function buildCartPayload(product, selections) {
            const basePayload = {
                productId: product.id,
                name: product.name,
                type: product.type,
                category: product.category,
                price: product.price,
                originalPrice: product.originalPrice,
                image: product.image,
                placeholder: product.placeholder
            };

            if (product.type === 'physical') {
                return {
                    ...basePayload,
                    variant: selections.variant,
                    color: selections.color,
                    quantity: selections.quantity,
                    selectedDate: null,
                    computedLinePrice: product.price * selections.quantity
                };
            }

            if (product.type === 'scheduled') {
                const adultQty = selections.adultQty || 0;
                const childQty = selections.childQty || 0;
                const adultPrice = product.adultPrice || product.price;
                const childPrice = product.childPrice || product.price;
                return {
                    ...basePayload,
                    variant: selections.variant || 'Standard',
                    selectedDate: selections.date,
                    selectedTime: selections.time || null,
                    adultQty: adultQty,
                    childQty: childQty,
                    quantity: adultQty + childQty,
                    computedLinePrice: (adultQty * adultPrice) + (childQty * childPrice)
                };
            }

            if (product.type === 'validityPass') {
                const adultQty = selections.adultQty || 0;
                const childQty = selections.childQty || 0;
                const adultPrice = product.adultPrice || product.price;
                const childPrice = product.childPrice || product.price;
                return {
                    ...basePayload,
                    variant: selections.variant || 'Standard',
                    selectedDate: null, // Explicitly null for validity pass
                    validUntil: product.validUntil,
                    adultQty: adultQty,
                    childQty: childQty,
                    quantity: adultQty + childQty,
                    computedLinePrice: (adultQty * adultPrice) + (childQty * childPrice)
                };
            }

            // Default payload
            return {
                ...basePayload,
                variant: selections.variant || 'Standard',
                quantity: selections.quantity || 1,
                computedLinePrice: product.price * (selections.quantity || 1)
            };
        }

        // Product Data for Upsells with type, category, and validUntil support
        // Product data - 4 canonical add-ons with type support (matching index.html)
        // Product data - 4 canonical add-ons with compatibleTours support (matching index.html)
        // compatibleTours: array of tour IDs this add-on can be paired with
        // null or undefined means compatible with all tours
        const productData = {
            'kwangjuyo': {
                name: 'Kwangjuyo',
                type: 'physical',
                category: 'products',
                price: 25,
                originalPrice: 35,
                image: 'imgs/kwangjuyo.webp',
                placeholder: null,
                description: 'Experience the elegance of traditional Korean ceramics with Kwangjuyo\'s exquisite collection. Each piece is handcrafted by master artisans.',
                hasVariants: true,
                variants: [
                    { id: 'sound-cup', name: 'Sound Cup', image: 'imgs/kwangjuyo.webp', description: 'A beautiful cup that resonates with the clear, melodious sound of ceramic beads crafted from clay.' },
                    { id: 'marble-cup', name: 'Marble Cup', image: 'imgs/kwangjuyo.webp', description: 'The clear ring of the marble cup is believed to ward off negative energy and bring good fortune.' }
                ],
                colors: [
                    { name: 'Soft Blush', image: 'imgs/kwangjuyo.webp' },
                    { name: 'Gentle Pine', image: 'imgs/kwangjuyo.webp' },
                    { name: 'Autumn Haze', image: 'imgs/kwangjuyo.webp' },
                    { name: 'Pure White', image: 'imgs/kwangjuyo.webp' }
                ],
                compatibleTours: ['tour01', 'tour02', 'tour04'] // Requires Tour 01, Tour 02, or Tour 04
            },
            'sejong-backstage': {
                name: 'Backstage Pass Sejong Centre',
                type: 'scheduled',
                category: 'experiences',
                price: 8,
                originalPrice: 12,
                adultPrice: 8,
                childPrice: 5,
                image: null,
                placeholder: 'ðŸŽ­',
                description: 'Go behind the scenes at Korea\'s premier performing arts venue with exclusive backstage access to the Sejong Center for the Performing Arts.',
                hasVariants: false,
                variants: null,
                colors: null,
                compatibleTours: ['tour01'] // Only compatible with Tour 01
            },
            'museum-pass': {
                name: 'Museum Pass',
                type: 'validityPass',
                category: 'experiences',
                price: 25,
                originalPrice: 35,
                adultPrice: 25,
                childPrice: 15,
                validUntil: '2025-06-30',
                image: null,
                placeholder: 'ðŸ›ï¸',
                description: 'Access to major museums in Seoul. Valid for multiple entries during the validity period.',
                hasVariants: false,
                variants: null,
                colors: null,
                compatibleTours: ['tour01'] // Only compatible with Tour 01
            },
            'han-river-cruise': {
                name: 'Han River Cruise',
                type: 'cruise',
                category: 'experiences',
                price: 25,
                originalPrice: 35,
                adultPrice: 25,
                childPrice: 18,
                image: 'imgs/daycruise.png',
                placeholder: 'ðŸš¢',
                description: 'Scenic cruise along the Han River with stunning views of Seoul\'s skyline. Choose from Day, Sunset, or Night cruises.',
                hasVariants: false,
                variants: null,
                colors: null,
                cruiseTypes: [
                    { id: 'day', name: 'Day Cruise', image: 'imgs/daycruise.png', price: 25, originalPrice: 35, adultPrice: 25, childPrice: 18 },
                    { id: 'sunset', name: 'Sunset Cruise', image: 'imgs/sunsetcruise.png', price: 30, originalPrice: 40, adultPrice: 30, childPrice: 20 },
                    { id: 'night', name: 'Night Cruise', image: 'imgs/moonlightcruise.png', price: 35, originalPrice: 45, adultPrice: 35, childPrice: 22 }
                ],
                timeSlots: [
                    { id: 'morning', label: '10:00 AM - 5:00 PM', value: '10:00-17:00' },
                    { id: 'evening', label: '5:00 PM - 10:00 PM', value: '17:00-22:00' }
                ],
                compatibleTours: ['tour02'] // Only compatible with Tour 02
            },
            'hanbok-rental': {
                name: 'Hanbok Rental',
                type: 'scheduled',
                category: 'services',
                price: 20,
                originalPrice: 30,
                adultPrice: 20,
                childPrice: 12,
                image: './imgs/hanbok-addon.png',
                placeholder: 'ðŸ‘˜',
                description: 'Traditional Korean dress rental. Includes accessories and photo opportunities at scenic locations.',
                hasVariants: false,
                variants: null,
                colors: null,
                operationHours: '10:00-18:00',
                compatibleTours: null // Compatible with all tours
            }
        };

        // Upsell Cart with type-aware logic
        const UpsellCart = {
            items: [],

            /**
             * Add item using buildCartPayload for type-aware payload construction
             * @param {Object} item - Can be raw item or already-built payload
             */
            addItem(item) {
                // Determine unique key based on type
                const getItemKey = (i) => {
                    if (i.type === 'physical') {
                        return `${i.productId}-${i.variant}-${i.color || 'default'}`;
                    }
                    if (i.type === 'scheduled') {
                        return `${i.productId}-${i.variant}-${i.selectedDate || 'no-date'}`;
                    }
                    if (i.type === 'validityPass') {
                        return `${i.productId}-${i.variant}-validity`;
                    }
                    return `${i.productId}-${i.variant}-${i.color || 'default'}`;
                };

                const itemKey = getItemKey(item);
                const existingIndex = this.items.findIndex(i => getItemKey(i) === itemKey);

                if (existingIndex >= 0) {
                    // Update quantities based on type
                    const existing = this.items[existingIndex];
                    if (item.type === 'physical') {
                        existing.quantity += item.quantity;
                        existing.computedLinePrice = existing.price * existing.quantity;
                    } else {
                        // For scheduled/validityPass, update adult/child quantities
                        existing.adultQty = (existing.adultQty || 0) + (item.adultQty || 0);
                        existing.childQty = (existing.childQty || 0) + (item.childQty || 0);
                        existing.quantity = existing.adultQty + existing.childQty;
                        existing.computedLinePrice = item.computedLinePrice || (existing.price * existing.quantity);
                    }
                } else {
                    this.items.push(item);
                }
                this.updateCartUI();
            },

            removeItem(index) {
                this.items.splice(index, 1);
                this.updateCartUI();
            },

            updateItemQuantity(index, quantity) {
                if (quantity <= 0) {
                    this.removeItem(index);
                } else {
                    const item = this.items[index];
                    item.quantity = quantity;
                    item.computedLinePrice = item.price * quantity;
                    this.updateCartUI();
                }
            },

            getTotal() {
                return this.items.reduce((sum, item) => {
                    // Use computedLinePrice if available, otherwise calculate
                    if (item.computedLinePrice !== undefined) {
                        return sum + item.computedLinePrice;
                    }
                    return sum + (item.price * item.quantity);
                }, 0);
            },

            getOriginalTotal() {
                return this.items.reduce((sum, item) => sum + (item.originalPrice * item.quantity), 0);
            },

            getItemCount() {
                return this.items.reduce((sum, item) => sum + item.quantity, 0);
            },

            /**
             * Get cart summary for order payload
             */
            getOrderPayload() {
                return this.items.map(item => ({
                    addonId: item.productId,
                    title: item.name,
                    type: item.type,
                    category: item.category,
                    selectedDate: item.selectedDate || null,
                    selectedTime: item.selectedTime || null,
                    quantity: item.quantity,
                    adultQty: item.adultQty || null,
                    childQty: item.childQty || null,
                    validUntil: item.validUntil || null,
                    variant: item.variant,
                    color: item.color || null,
                    computedLinePrice: item.computedLinePrice || (item.price * item.quantity)
                }));
            },
            updateCartUI() {
                const cartBar = document.getElementById('upsell-cart-bar');
                const cartCount = document.getElementById('cart-count');
                const cartItemsText = document.getElementById('cart-items-text');
                const cartTotal = document.getElementById('cart-total');
                const cartTotalExpanded = document.getElementById('cart-total-expanded');
                const cartItemsList = document.getElementById('cart-items-list');

                const itemCount = this.getItemCount();
                const total = this.getTotal();

                if (itemCount > 0) {
                    cartBar.classList.add('visible');
                    document.body.classList.add('cart-visible');
                    cartCount.textContent = itemCount;
                    cartItemsText.textContent = `${itemCount} item${itemCount > 1 ? 's' : ''} added`;
                    cartTotal.textContent = `$${total.toFixed(2)}`;
                    cartTotalExpanded.textContent = `$${total.toFixed(2)}`;

                    // Update cart items list with type-aware display
                    cartItemsList.innerHTML = this.items.map((item, index) => {
                        // Build description based on type
                        let itemDesc = item.variant || '';
                        if (item.type === 'physical') {
                            itemDesc = `${item.variant}${item.color ? ` - ${item.color}` : ''} Ã— ${item.quantity}`;
                        } else if (item.type === 'scheduled') {
                            const dateStr = item.selectedDate ? ` â€¢ ${item.selectedDate}` : '';
                            const timeStr = item.selectedTime ? ` @ ${item.selectedTime}` : '';
                            itemDesc = `${item.variant}${dateStr}${timeStr} â€¢ Adult: ${item.adultQty || 0}, Child: ${item.childQty || 0}`;
                        } else if (item.type === 'validityPass') {
                            const validStr = item.validUntil ? ` â€¢ Valid until ${item.validUntil}` : '';
                            itemDesc = `${item.variant}${validStr} â€¢ Adult: ${item.adultQty || 0}, Child: ${item.childQty || 0}`;
                        } else {
                            itemDesc = `${item.variant}${item.color ? ` - ${item.color}` : ''} Ã— ${item.quantity}`;
                        }

                        const displayPrice = item.computedLinePrice !== undefined
                            ? item.computedLinePrice
                            : (item.price * item.quantity);

                        return `
                            <div class="cart-item">
                                <div class="cart-item-info">
                                    ${item.image ?
                                        `<img src="${item.image}" alt="${item.name}" class="cart-item-image">` :
                                        `<div class="cart-item-image" style="background: #f5f5f5; display: flex; align-items: center; justify-content: center; font-size: 24px;">${item.placeholder || 'ðŸ“¦'}</div>`
                                    }
                                    <div class="cart-item-details">
                                        <h5>${item.name}</h5>
                                        <span>${itemDesc}</span>
                                    </div>
                                </div>
                                <span class="cart-item-price">$${displayPrice.toFixed(2)}</span>
                            </div>
                        `;
                    }).join('');
                } else {
                    cartBar.classList.remove('visible');
                    document.body.classList.remove('cart-visible');
                }
            }
        };

        // Current product state
        let currentProduct = null;
        let currentVariant = null;
        let currentColor = null;
        let productQuantity = 1;
        // Additional state for scheduled/validityPass types
        let productSelectedDate = null;
        let productSelectedTime = null;
        let productAdultQty = 0;
        let productChildQty = 0;

        // Tour pricing
        const tourPricing = {
            tour01: {
                adult: { current: 20, original: 25 },
                child: { current: 15, original: 20 }
            },
            tour04: {
                adult: { current: 18, original: 22 },
                child: { current: 12, original: 15 }
            }
        };

        // Tours data
        const tours = {
            tour01: {
                name: 'Downtown Palace Namsan Course',
                type: 'Hop On, Hop Off',
                label: 'TOUR 01',
                labelColor: '#000080',
                image: 'imgs/tour01__.png',
                title: 'DOWNTOWN PALACE NAMSAN COURSE',
                isPopular: false
            },
            tour04: {
                name: 'Night View Course',
                type: 'Non-Stop, 30 Min Photo Time',
                label: 'TOUR 04',
                labelColor: '#FFD700',
                image: 'imgs/tour02__.png',
                title: 'NIGHT VIEW COURSE',
                isPopular: true
            },
            tour02: {
                name: 'Panorama Course',
                type: 'Scenic Views',
                label: 'TOUR 02',
                labelColor: '#C41E3A',
                image: 'imgs/panorama.png',
                title: 'PANORAMA COURSE',
                isPopular: false
            }
        };

        // Update tour display
        function updateTourDisplay(tourId) {
            const tourDisplay = document.getElementById('tour-display');
            if (!tourDisplay) return;

            const tour = tours[tourId];
            tourDisplay.innerHTML = `
                <div class="tour-label" style="background: ${tour.labelColor}">${tour.label}</div>
                ${tour.isPopular ? '<div class="popular-badge">POPULAR</div>' : ''}
                <img src="${tour.image}" alt="${tour.name}">
                <div class="tour-title">${tour.title}</div>
            `;
        }

        // Hanbok Info Modal Functions
        function showHanbokInfoModal() {
            const hanbokModal = document.getElementById('hanbokInfoModal');
            if (hanbokModal) {
                hanbokModal.classList.add('active');
                document.body.style.overflow = 'hidden';
                // Always start at Step 1
                showHanbokStep(1);
            }
        }

        function showHanbokStep(stepNumber) {
            const steps = [1, 2, 3, 4];
            steps.forEach(num => {
                const step = document.getElementById(`hanbokStep${num}`);
                const footer = document.getElementById(`hanbokStep${num}Footer`);
                if (step) step.style.display = num === stepNumber ? 'block' : 'none';
                if (footer) footer.style.display = num === stepNumber ? 'flex' : 'none';
            });

            // Populate order summaries when showing relevant steps
            if (stepNumber === 2) {
                populateHanbokOrderSummary(true); // Editable
            } else if (stepNumber === 4) {
                populateHanbokFinalOrderSummary(); // Read-only
            }
        }

        function populateHanbokOrderSummary(editable = true) {
            const orderItemsContainer = document.getElementById('hanbokOrderItems');
            const subtotalEl = document.getElementById('hanbokSubtotal');
            const savingsEl = document.getElementById('hanbokSavings');
            const savingsRow = document.getElementById('hanbokSavingsRow');
            const totalEl = document.getElementById('hanbokTotal');

            if (!orderItemsContainer) return;

            const cartItems = UpsellCart.items || [];

            let orderHTML = '';
            let subtotal = 0;
            let originalTotal = 0;

            cartItems.forEach((item, index) => {
                const itemTotal = item.computedLinePrice || (item.price * item.quantity);
                const itemOrigTotal = (item.originalPrice || item.price) * item.quantity;
                subtotal += itemTotal;
                originalTotal += itemOrigTotal;

                let metaInfo = '';

                if (item.type === 'scheduled' || item.type === 'cruise' || item.type === 'validityPass') {
                    if (item.selectedDate) metaInfo = item.selectedDate;

                    if (editable) {
                        // Build separate rows for Adult and Child with inline controls
                        if (item.adultQty > 0 || item.childQty === 0) {
                            const adultTotal = (item.adultQty || 0) * (item.adultPrice || item.price);
                            orderHTML += `
                                <div class="hanbok-order-item">
                                    <div class="hanbok-order-item-info">
                                        <div class="hanbok-order-item-name">${item.name}</div>
                                        <div class="hanbok-order-item-meta">Adult${metaInfo ? ' â€¢ ' + metaInfo : ''}</div>
                                    </div>
                                    <div class="hanbok-order-item-controls">
                                        <div class="hanbok-order-item-qty">
                                            <button class="qty-btn minus" data-index="${index}" data-type="adult">âˆ’</button>
                                            <span class="qty-value">${item.adultQty || 0}</span>
                                            <button class="qty-btn plus" data-index="${index}" data-type="adult">+</button>
                                        </div>
                                        <div class="hanbok-order-item-price">$${adultTotal.toFixed(2)}</div>
                                    </div>
                                </div>
                            `;
                        }
                        if (item.childQty > 0 || item.adultQty === 0) {
                            const childTotal = (item.childQty || 0) * (item.childPrice || item.price);
                            orderHTML += `
                                <div class="hanbok-order-item">
                                    <div class="hanbok-order-item-info">
                                        <div class="hanbok-order-item-name">${item.name}</div>
                                        <div class="hanbok-order-item-meta">Child${metaInfo ? ' â€¢ ' + metaInfo : ''}</div>
                                    </div>
                                    <div class="hanbok-order-item-controls">
                                        <div class="hanbok-order-item-qty">
                                            <button class="qty-btn minus" data-index="${index}" data-type="child">âˆ’</button>
                                            <span class="qty-value">${item.childQty || 0}</span>
                                            <button class="qty-btn plus" data-index="${index}" data-type="child">+</button>
                                        </div>
                                        <div class="hanbok-order-item-price">$${childTotal.toFixed(2)}</div>
                                    </div>
                                </div>
                            `;
                        }
                    } else {
                        // Read-only display
                        if (item.adultQty > 0) metaInfo = `${item.adultQty} Adult` + (metaInfo ? ' â€¢ ' + metaInfo : '');
                        if (item.childQty > 0) metaInfo = (item.adultQty > 0 ? metaInfo + ', ' : '') + `${item.childQty} Child` + (item.selectedDate && !item.adultQty ? ' â€¢ ' + item.selectedDate : '');
                        orderHTML += `
                            <div class="hanbok-order-item">
                                <div class="hanbok-order-item-info">
                                    <div class="hanbok-order-item-name">${item.name}</div>
                                    <div class="hanbok-order-item-meta">${metaInfo}</div>
                                </div>
                                <div class="hanbok-order-item-price">$${itemTotal.toFixed(2)}</div>
                            </div>
                        `;
                    }
                } else {
                    // Physical product with simple quantity
                    metaInfo = item.variant && item.variant !== 'Standard' ? item.variant : '';

                    if (editable) {
                        orderHTML += `
                            <div class="hanbok-order-item">
                                <div class="hanbok-order-item-info">
                                    <div class="hanbok-order-item-name">${item.name}</div>
                                    <div class="hanbok-order-item-meta">${metaInfo || 'Standard'}</div>
                                </div>
                                <div class="hanbok-order-item-controls">
                                    <div class="hanbok-order-item-qty">
                                        <button class="qty-btn minus" data-index="${index}" data-type="qty">âˆ’</button>
                                        <span class="qty-value">${item.quantity}</span>
                                        <button class="qty-btn plus" data-index="${index}" data-type="qty">+</button>
                                    </div>
                                    <div class="hanbok-order-item-price">$${itemTotal.toFixed(2)}</div>
                                </div>
                            </div>
                        `;
                    } else {
                        orderHTML += `
                            <div class="hanbok-order-item">
                                <div class="hanbok-order-item-info">
                                    <div class="hanbok-order-item-name">${item.name}</div>
                                    <div class="hanbok-order-item-meta">Qty: ${item.quantity}${metaInfo ? ' â€¢ ' + metaInfo : ''}</div>
                                </div>
                                <div class="hanbok-order-item-price">$${itemTotal.toFixed(2)}</div>
                            </div>
                        `;
                    }
                }
            });

            const savings = originalTotal - subtotal;

            orderItemsContainer.innerHTML = orderHTML;
            if (subtotalEl) subtotalEl.textContent = `$${subtotal.toFixed(2)}`;
            if (savingsEl) savingsEl.textContent = `-$${savings.toFixed(2)}`;
            if (savingsRow) savingsRow.style.display = savings > 0 ? 'flex' : 'none';
            if (totalEl) totalEl.textContent = `$${subtotal.toFixed(2)}`;

            // Attach quantity button handlers if editable
            if (editable) {
                attachHanbokQtyHandlers();
            }
        }

        function populateHanbokFinalOrderSummary() {
            const orderItemsContainer = document.getElementById('hanbokFinalOrderItems');
            const subtotalEl = document.getElementById('hanbokFinalSubtotal');
            const savingsEl = document.getElementById('hanbokFinalSavings');
            const savingsRow = document.getElementById('hanbokFinalSavingsRow');
            const totalEl = document.getElementById('hanbokFinalTotal');

            if (!orderItemsContainer) return;

            const cartItems = UpsellCart.items || [];

            let orderHTML = '';
            let subtotal = 0;
            let originalTotal = 0;

            cartItems.forEach(item => {
                const itemTotal = item.computedLinePrice || (item.price * item.quantity);
                const itemOrigTotal = (item.originalPrice || item.price) * item.quantity;
                subtotal += itemTotal;
                originalTotal += itemOrigTotal;

                let metaInfo = '';
                if (item.type === 'scheduled' || item.type === 'cruise' || item.type === 'validityPass') {
                    if (item.adultQty > 0) metaInfo += `${item.adultQty} Adult`;
                    if (item.childQty > 0) metaInfo += (metaInfo ? ', ' : '') + `${item.childQty} Child`;
                    if (item.selectedDate) metaInfo += ` â€¢ ${item.selectedDate}`;
                } else {
                    metaInfo = `Qty: ${item.quantity}`;
                    if (item.variant && item.variant !== 'Standard') metaInfo += ` â€¢ ${item.variant}`;
                }

                orderHTML += `
                    <div class="hanbok-order-item">
                        <div class="hanbok-order-item-info">
                            <div class="hanbok-order-item-name">${item.name}</div>
                            <div class="hanbok-order-item-meta">${metaInfo}</div>
                        </div>
                        <div class="hanbok-order-item-price">$${itemTotal.toFixed(2)}</div>
                    </div>
                `;
            });

            const savings = originalTotal - subtotal;

            orderItemsContainer.innerHTML = orderHTML;
            if (subtotalEl) subtotalEl.textContent = `$${subtotal.toFixed(2)}`;
            if (savingsEl) savingsEl.textContent = `-$${savings.toFixed(2)}`;
            if (savingsRow) savingsRow.style.display = savings > 0 ? 'flex' : 'none';
            if (totalEl) totalEl.textContent = `$${subtotal.toFixed(2)}`;
        }

        function attachHanbokQtyHandlers() {
            document.querySelectorAll('#hanbokOrderItems .qty-btn').forEach(btn => {
                btn.onclick = function() {
                    const index = parseInt(this.dataset.index);
                    const qtyType = this.dataset.type;
                    const isPlus = this.classList.contains('plus');

                    if (!UpsellCart || !UpsellCart.items[index]) return;

                    const item = UpsellCart.items[index];

                    if (qtyType === 'adult') {
                        const newQty = isPlus ? (item.adultQty || 0) + 1 : Math.max(0, (item.adultQty || 0) - 1);
                        item.adultQty = newQty;
                        item.quantity = (item.adultQty || 0) + (item.childQty || 0);
                        item.computedLinePrice = (item.adultQty * item.adultPrice) + (item.childQty * (item.childPrice || item.adultPrice));
                    } else if (qtyType === 'child') {
                        const newQty = isPlus ? (item.childQty || 0) + 1 : Math.max(0, (item.childQty || 0) - 1);
                        item.childQty = newQty;
                        item.quantity = (item.adultQty || 0) + (item.childQty || 0);
                        item.computedLinePrice = (item.adultQty * item.adultPrice) + (item.childQty * (item.childPrice || item.adultPrice));
                    } else {
                        const newQty = isPlus ? item.quantity + 1 : Math.max(1, item.quantity - 1);
                        item.quantity = newQty;
                    }

                    // Remove item if quantity is 0
                    if (item.quantity <= 0) {
                        UpsellCart.items.splice(index, 1);
                    }

                    // Refresh order summary
                    populateHanbokOrderSummary(true);

                    // Update cart bar
                    UpsellCart.updateCartUI();
                };
            });
        }

        function closeHanbokInfoModal() {
            const hanbokModal = document.getElementById('hanbokInfoModal');
            if (hanbokModal) {
                hanbokModal.classList.remove('active');
                document.body.style.overflow = '';
            }
        }

        function initHanbokInfoModal() {
            const hanbokModal = document.getElementById('hanbokInfoModal');
            const closeBtn = document.getElementById('closeHanbokInfo');

            if (closeBtn) {
                closeBtn.addEventListener('click', closeHanbokInfoModal);
            }

            // Step 1 -> Step 2
            const continueToStep2Btn = document.getElementById('hanbokContinueToStep2Btn');
            if (continueToStep2Btn) {
                continueToStep2Btn.addEventListener('click', () => showHanbokStep(2));
            }

            // Step 2 -> Step 1
            const backToStep1Btn = document.getElementById('hanbokBackToStep1Btn');
            if (backToStep1Btn) {
                backToStep1Btn.addEventListener('click', () => showHanbokStep(1));
            }

            // Step 2 -> Step 3
            const continueToStep3Btn = document.getElementById('hanbokContinueToStep3Btn');
            if (continueToStep3Btn) {
                continueToStep3Btn.addEventListener('click', () => showHanbokStep(3));
            }

            // Step 3 -> Step 2
            const backToStep2Btn = document.getElementById('hanbokBackToStep2Btn');
            if (backToStep2Btn) {
                backToStep2Btn.addEventListener('click', () => showHanbokStep(2));
            }

            // Step 3 -> Step 4
            const continueToStep4Btn = document.getElementById('hanbokContinueToStep4Btn');
            if (continueToStep4Btn) {
                continueToStep4Btn.addEventListener('click', function() {
                    // Validate form
                    const name = document.getElementById('hanbokUserName')?.value?.trim();
                    const email = document.getElementById('hanbokUserEmail')?.value?.trim();
                    const terms = document.getElementById('hanbokTerms')?.checked;

                    if (!name || !email) {
                        alert('Please fill in your name and email.');
                        return;
                    }
                    if (!terms) {
                        alert('Please agree to the Terms & Conditions.');
                        return;
                    }
                    showHanbokStep(4);
                });
            }

            // Step 4 -> Step 3
            const backToStep3Btn = document.getElementById('hanbokBackToStep3Btn');
            if (backToStep3Btn) {
                backToStep3Btn.addEventListener('click', () => showHanbokStep(3));
            }

            // Make Payment button
            const makePaymentBtn = document.getElementById('hanbokMakePaymentBtn');
            if (makePaymentBtn) {
                makePaymentBtn.addEventListener('click', function() {
                    alert('Processing payment...');
                    closeHanbokInfoModal();

                    // Hide cart bar
                    const cartBar = document.getElementById('upsell-cart-bar');
                    if (cartBar) {
                        cartBar.classList.remove('visible');
                        document.body.classList.remove('cart-visible');
                    }

                    // Clear cart
                    if (UpsellCart) {
                        UpsellCart.items = [];
                        UpsellCart.updateCartUI();
                    }

                    document.body.style.overflow = '';
                });
            }

            // Close on overlay click
            if (hanbokModal) {
                hanbokModal.addEventListener('click', (e) => {
                    if (e.target === hanbokModal) closeHanbokInfoModal();
                });
            }
        }

        // Initialize booking page
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Booking page JavaScript initializing...');
            try {
                initHanbokInfoModal();
                console.log('âœ“ Hanbok info modal initialized');
                initTourSelector();
                console.log('âœ“ Tour selector initialized');
                initCalendar();
                console.log('âœ“ Calendar initialized');
                initTicketCounters();
                console.log('âœ“ Ticket counters initialized');
                initCrossSellCarousels();
                console.log('âœ“ Cross-sell carousels initialized');
                initCategoryTabs();
                console.log('âœ“ Category tabs initialized');
                initProductDetailsModal();
                console.log('âœ“ Product details modal initialized');
                initStepNavigation();
                console.log('âœ“ Step navigation initialized');
                initCartBar();
                console.log('âœ“ Cart bar initialized');
                updatePricing();
                console.log('âœ“ Pricing updated');
                console.log('Booking page JavaScript fully initialized!');
            } catch (error) {
                console.error('Error initializing booking page:', error);
            }
        });

        // Function to update product card compatibility based on selected tour
        function updateProductCardCompatibility(tourId) {
            const productCards = document.querySelectorAll('.product-card[data-product-id]');
            productCards.forEach(card => {
                const productId = card.dataset.productId;
                const product = productData[productId];

                if (product && product.compatibleTours && product.compatibleTours.length > 0) {
                    // Product has specific tour requirements
                    if (!product.compatibleTours.includes(tourId)) {
                        // Incompatible - fade out and show label
                        card.classList.add('incompatible');
                    } else {
                        // Compatible - remove faded state
                        card.classList.remove('incompatible');
                    }
                } else {
                    // Universal product - always compatible
                    card.classList.remove('incompatible');
                }
            });
        }

        // Tour selector
        function initTourSelector() {
            const tourSelect = document.getElementById('tour-select');
            const tour01Info = document.querySelector('.tour01-info');
            const tour04Info = document.querySelector('.tour04-info');
            const tour02Info = document.querySelector('.tour02-info');

            // Check for URL parameter to preselect tour
            const urlParams = new URLSearchParams(window.location.search);
            const tourParam = urlParams.get('tour');
            if (tourParam && ['tour01', 'tour02', 'tour04'].includes(tourParam)) {
                tourSelect.value = tourParam;
            }

            // Initial display
            updateTourDisplay(tourSelect.value);

            // Initial tour info panel state
            function updateTourInfoPanel(tourValue) {
                if (tour01Info) tour01Info.classList.remove('active');
                if (tour04Info) tour04Info.classList.remove('active');
                if (tour02Info) tour02Info.classList.remove('active');

                if (tourValue === 'tour01' && tour01Info) {
                    tour01Info.classList.add('active');
                } else if (tourValue === 'tour04' && tour04Info) {
                    tour04Info.classList.add('active');
                } else if (tourValue === 'tour02' && tour02Info) {
                    tour02Info.classList.add('active');
                }
            }

            updateTourInfoPanel(tourSelect.value);

            // Initial product card compatibility update
            updateProductCardCompatibility(tourSelect.value);

            // Handle change
            tourSelect.addEventListener('change', function() {
                updateTourDisplay(this.value);
                updatePricing();
                updateTourInfoPanel(this.value);
                // Update product card compatibility when tour changes
                updateProductCardCompatibility(this.value);
            });

            // Tour Map Popup functionality
            const mapButtons = document.querySelectorAll('.tour-map-btn');
            const mapPopup = document.getElementById('tourMapPopup');
            const mapPopupClose = document.querySelector('.tour-map-popup-close');
            const mapLabel = document.querySelector('.tour-map-label');

            if (mapButtons && mapPopup) {
                mapButtons.forEach(btn => {
                    btn.addEventListener('click', function(e) {
                        e.preventDefault();
                        e.stopPropagation();
                        const tour = this.dataset.tour;
                        // Update label for different tours
                        if (mapLabel) {
                            if (tour === 'tour01') {
                                mapLabel.textContent = 'Tour 01 Map';
                            } else if (tour === 'tour04') {
                                mapLabel.textContent = 'Tour 04 Map';
                            } else if (tour === 'tour02') {
                                mapLabel.textContent = 'Tour 02 Map';
                            }
                        }
                        mapPopup.classList.add('active');
                        document.body.style.overflow = 'hidden';
                    });
                });

                // Close popup
                if (mapPopupClose) {
                    mapPopupClose.addEventListener('click', function() {
                        mapPopup.classList.remove('active');
                        document.body.style.overflow = '';
                    });
                }

                // Close on overlay click
                mapPopup.addEventListener('click', function(e) {
                    if (e.target === mapPopup) {
                        mapPopup.classList.remove('active');
                        document.body.style.overflow = '';
                    }
                });

                // Close on Escape key
                document.addEventListener('keydown', function(e) {
                    if (e.key === 'Escape' && mapPopup.classList.contains('active')) {
                        mapPopup.classList.remove('active');
                        document.body.style.overflow = '';
                    }
                });
            }
        }

        // Calendar functionality
        let currentMonth = new Date().getMonth();
        let currentYear = new Date().getFullYear();
        let selectedDate = null;

        function initCalendar() {
            const dateTrigger = document.getElementById('date-trigger');
            const calendarDropdown = document.getElementById('calendar-dropdown');
            const prevMonth = document.getElementById('prev-month');
            const nextMonth = document.getElementById('next-month');

            dateTrigger.addEventListener('click', () => {
                calendarDropdown.classList.toggle('active');
            });

            prevMonth.addEventListener('click', () => {
                currentMonth--;
                if (currentMonth < 0) {
                    currentMonth = 11;
                    currentYear--;
                }
                renderCalendar();
            });

            nextMonth.addEventListener('click', () => {
                currentMonth++;
                if (currentMonth > 11) {
                    currentMonth = 0;
                    currentYear++;
                }
                renderCalendar();
            });

            // Close calendar when clicking outside
            document.addEventListener('click', (e) => {
                if (!e.target.closest('.date-picker-wrapper')) {
                    calendarDropdown.classList.remove('active');
                }
            });

            renderCalendar();
        }

        function renderCalendar() {
            const monthNames = ['January', 'February', 'March', 'April', 'May', 'June',
                'July', 'August', 'September', 'October', 'November', 'December'];

            document.getElementById('current-month').textContent = `${monthNames[currentMonth]} ${currentYear}`;

            const daysContainer = document.getElementById('calendar-days');
            daysContainer.innerHTML = '';

            const firstDay = new Date(currentYear, currentMonth, 1).getDay();
            const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();
            const today = new Date();

            // Empty cells for days before first day of month
            for (let i = 0; i < firstDay; i++) {
                const emptyDay = document.createElement('div');
                emptyDay.className = 'day disabled';
                daysContainer.appendChild(emptyDay);
            }

            // Days of the month
            for (let day = 1; day <= daysInMonth; day++) {
                const dayEl = document.createElement('div');
                dayEl.className = 'day';
                dayEl.textContent = day;

                const dateToCheck = new Date(currentYear, currentMonth, day);
                const isMonday = dateToCheck.getDay() === 1; // Monday = 1, closed on Mondays

                // Disable past dates and Mondays (closed)
                if (dateToCheck < new Date(today.getFullYear(), today.getMonth(), today.getDate()) || isMonday) {
                    dayEl.classList.add('disabled');
                    if (isMonday) {
                        dayEl.title = 'Closed on Mondays';
                    }
                } else {
                    // Random availability for demo
                    const isAvailable = Math.random() > 0.2;
                    const dot = document.createElement('span');
                    dot.className = `dot ${isAvailable ? 'available' : 'sold-out'}`;
                    dayEl.appendChild(dot);

                    if (isAvailable) {
                        dayEl.addEventListener('click', () => selectDate(day));
                    } else {
                        dayEl.classList.add('disabled');
                    }
                }

                // Check if this is the selected date
                if (selectedDate &&
                    selectedDate.getDate() === day &&
                    selectedDate.getMonth() === currentMonth &&
                    selectedDate.getFullYear() === currentYear) {
                    dayEl.classList.add('selected');
                }

                daysContainer.appendChild(dayEl);
            }
        }

        function selectDate(day) {
            selectedDate = new Date(currentYear, currentMonth, day);
            const monthNames = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun',
                'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
            document.querySelector('.selected-date').textContent =
                `${monthNames[currentMonth]} ${day}, ${currentYear}`;
            document.getElementById('calendar-dropdown').classList.remove('active');
            renderCalendar();
        }

        // Ticket counters
        function initTicketCounters() {
            const buttons = document.querySelectorAll('.ticket-type .counter button');
            console.log(`Found ${buttons.length} ticket counter buttons`);

            buttons.forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.preventDefault();
                    const type = this.dataset.type;
                    const input = document.getElementById(`${type}-count`);

                    if (!input) {
                        console.error(`Input not found for type: ${type}`);
                        return;
                    }

                    let value = parseInt(input.value) || 0;

                    if (this.classList.contains('increase')) {
                        value++;
                        console.log(`Increased ${type} to ${value}`);
                    } else if (this.classList.contains('decrease') && value > 0) {
                        value--;
                        console.log(`Decreased ${type} to ${value}`);
                    }

                    input.value = value;
                    updateTotals();
                });
            });
        }

        function updatePricing() {
            const tourSelect = document.getElementById('tour-select');
            if (!tourSelect) {
                console.error('Tour select element not found');
                return;
            }

            const selectedTour = tourSelect.value;
            const pricing = tourPricing[selectedTour];

            if (!pricing) {
                console.error(`Pricing not found for tour: ${selectedTour}`);
                return;
            }

            document.getElementById('adult-price').textContent = `$${pricing.adult.current.toFixed(2)}`;
            document.getElementById('adult-original').textContent = `$${pricing.adult.original.toFixed(2)}`;
            document.getElementById('child-price').textContent = `$${pricing.child.current.toFixed(2)}`;
            document.getElementById('child-original').textContent = `$${pricing.child.original.toFixed(2)}`;

            updateTotals();
        }

        function updateTotals() {
            const tourSelect = document.getElementById('tour-select');
            const selectedTour = tourSelect.value;
            const pricing = tourPricing[selectedTour];

            const adultCount = parseInt(document.getElementById('adult-count').value) || 0;
            const childCount = parseInt(document.getElementById('child-count').value) || 0;

            const currentTotal = (adultCount * pricing.adult.current) + (childCount * pricing.child.current);
            const originalTotal = (adultCount * pricing.adult.original) + (childCount * pricing.child.original);

            document.getElementById('current-total').textContent = `$${currentTotal.toFixed(2)}`;
            document.getElementById('original-total').textContent = `$${originalTotal.toFixed(2)}`;

            if (originalTotal > currentTotal) {
                document.getElementById('original-total').style.display = 'inline';
            } else {
                document.getElementById('original-total').style.display = 'none';
            }
        }

        // Cross-sell carousels
        function initCrossSellCarousels() {
            document.querySelectorAll('.products-grid').forEach(grid => {
                const carousel = grid.querySelector('.cross-sell-carousel');
	                if (!carousel) return;
	                const slides = carousel.querySelectorAll('.cross-sell-slide');
	                const dots = grid.querySelectorAll('.cross-sell-dots .dot');
	                const prevBtn = carousel.querySelector('.cross-sell-nav.prev');
	                const nextBtn = carousel.querySelector('.cross-sell-nav.next');
                let currentSlide = 0;
	
	                // Hide arrows when this category has only 1 product/slide.
	                const hasMultipleSlides = slides.length > 1;
	                if (prevBtn) prevBtn.style.display = hasMultipleSlides ? '' : 'none';
	                if (nextBtn) nextBtn.style.display = hasMultipleSlides ? '' : 'none';

                function showSlide(index) {
                    slides.forEach((slide, i) => {
                        slide.classList.toggle('active', i === index);
                    });
                    dots.forEach((dot, i) => {
                        dot.classList.toggle('active', i === index);
                    });
                    currentSlide = index;
                }

                prevBtn?.addEventListener('click', () => {
                    const newIndex = currentSlide > 0 ? currentSlide - 1 : slides.length - 1;
                    showSlide(newIndex);
                });

                nextBtn?.addEventListener('click', () => {
                    const newIndex = currentSlide < slides.length - 1 ? currentSlide + 1 : 0;
                    showSlide(newIndex);
                });

                dots.forEach((dot, index) => {
                    dot.addEventListener('click', () => showSlide(index));
                });
            });
        }

        // Category tabs
        function initCategoryTabs() {
            document.querySelectorAll('.category-tabs .category-tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    const category = this.dataset.category;

                    // Update active tab
                    document.querySelectorAll('.category-tabs .category-tab').forEach(t => {
                        t.classList.remove('active');
                    });
                    this.classList.add('active');

                    // Show corresponding grid
                    document.querySelectorAll('.products-grid').forEach(grid => {
                        grid.classList.toggle('active', grid.dataset.category === category);
                    });
                });
            });
        }

        // Product details modal
        function initProductDetailsModal() {
            const modal = document.getElementById('product-details-modal');
            const closeBtn = document.getElementById('close-product-modal');
            const closeBtn2 = document.getElementById('close-product-details');
            const addToCartBtn = document.getElementById('add-to-cart-btn');
            const decreaseBtn = document.getElementById('product-decrease');
            const increaseBtn = document.getElementById('product-increase');
            const quantityInput = document.getElementById('product-quantity');

            // View Details buttons
            document.querySelectorAll('.view-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const card = this.closest('.product-card');
                    const productId = card.dataset.productId;
                    openProductModal(productId);
                });
            });

            closeBtn.addEventListener('click', () => {
                modal.style.display = 'none';
            });

            closeBtn2.addEventListener('click', () => {
                modal.style.display = 'none';
            });

            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.style.display = 'none';
                }
            });

            decreaseBtn.addEventListener('click', () => {
                if (productQuantity > 1) {
                    productQuantity--;
                    quantityInput.value = productQuantity;
                    updateAddToCartButton();
                }
            });

            increaseBtn.addEventListener('click', () => {
                productQuantity++;
                quantityInput.value = productQuantity;
                updateAddToCartButton();
            });

            addToCartBtn.addEventListener('click', () => {
                if (currentProduct) {
                    // Check for per-color quantity mode for physical products
                    const colorQtyItems = document.querySelectorAll('.booking-color-qty-item');
                    if (currentProduct.type === 'physical' && colorQtyItems.length > 0) {
                        // Per-color quantity mode - collect all colors with qty > 0
                        const itemsToAdd = [];
                        colorQtyItems.forEach(item => {
                            const qtyEl = item.querySelector('.booking-color-qty-value');
                            const qty = parseInt(qtyEl?.textContent) || 0;
                            if (qty > 0) {
                                const colorName = item.dataset.colorName;
                                const colorIndex = parseInt(item.dataset.colorIndex);
                                itemsToAdd.push({ color: colorName, colorIndex: colorIndex, quantity: qty });
                            }
                        });

                        if (itemsToAdd.length === 0) {
                            alert('Please select at least 1 item.');
                            return;
                        }

                        // Add each color as a separate cart item
                        const variantName = currentVariant?.name || currentProduct.name;
                        itemsToAdd.forEach(item => {
                            const cartItem = {
                                productId: `${currentProduct.id}-${variantName.toLowerCase().replace(/\s+/g, '-')}-${item.color.toLowerCase().replace(/\s+/g, '-')}`,
                                name: `${currentProduct.name} - ${variantName} (${item.color})`,
                                type: currentProduct.type,
                                category: currentProduct.category,
                                price: currentProduct.price,
                                originalPrice: currentProduct.originalPrice,
                                quantity: item.quantity,
                                image: currentProduct.colors?.[item.colorIndex]?.image || currentProduct.image,
                                placeholder: currentProduct.placeholder,
                                variant: variantName,
                                selectedColor: item.color,
                                computedLinePrice: currentProduct.price * item.quantity
                            };
                            UpsellCart.addItem(cartItem);
                        });

                        modal.style.display = 'none';

                        // Reset state
                        productQuantity = 1;
                        quantityInput.value = 1;
                        return;
                    }

                    // Build selections based on product type (legacy single-selection mode)
                    const selections = {
                        variant: currentVariant?.name || currentVariant?.id || 'Standard',
                        color: currentColor?.name || null,
                        quantity: productQuantity,
                        date: productSelectedDate,
                        time: productSelectedTime,
                        adultQty: productAdultQty,
                        childQty: productChildQty
                    };

                    // Validate using canAddToCart
                    if (!canAddToCart(currentProduct, selections)) {
                        if (currentProduct.type === 'physical') {
                            alert('Please select a variant and quantity.');
                        } else if (currentProduct.type === 'scheduled') {
                            // Check if time is required
                            const requiresTime = currentProduct.availableTimes && currentProduct.availableTimes.length > 0;
                            if (requiresTime && !selections.time) {
                                alert('Please select a date, time, and at least one ticket.');
                            } else {
                                alert('Please select a date and at least one ticket.');
                            }
                        } else if (currentProduct.type === 'validityPass') {
                            alert('Please select at least one ticket.');
                        }
                        return;
                    }

                    // Build cart payload using the helper function
                    const cartItem = buildCartPayload(currentProduct, selections);
                    UpsellCart.addItem(cartItem);

                    modal.style.display = 'none';

                    // Show Hanbok Info Modal if hanbok-rental was added
                    if (currentProduct.id === 'hanbok-rental') {
                        showHanbokInfoModal();
                    }

                    // Reset state
                    productQuantity = 1;
                    productSelectedDate = null;
                    productSelectedTime = null;
                    productAdultQty = 0;
                    productChildQty = 0;
                    quantityInput.value = 1;
                }
            });
        }

        function openProductModal(productId) {
            const product = productData[productId];
            if (!product) return;

            currentProduct = { ...product, id: productId };
            currentVariant = product.variants?.[0] || null;
            currentColor = product.colors?.[0] || null;
            productQuantity = 1;
            // Reset scheduled/validityPass state
            productSelectedDate = null;
            productSelectedTime = null;
            productAdultQty = 0;
            productChildQty = 0;

            const modal = document.getElementById('product-details-modal');
            const mainImage = document.getElementById('product-main-image');
            const productImage = document.getElementById('product-image');
            const variantTabs = document.getElementById('product-variant-tabs');
            const detailsInfo = document.getElementById('product-details-info');
            const quantityInput = document.getElementById('product-quantity');
            const quantitySection = document.querySelector('.product-sticky-bottom .quantity-selector');

            // Show/hide quantity section based on type
            // Hide for scheduled/validityPass (they have inline adult/child counters)
            // Hide for physical products with colors (they have per-color quantity counters)
            if (product.type === 'scheduled' || product.type === 'validityPass' ||
                (product.type === 'physical' && product.colors && product.colors.length > 0)) {
                if (quantitySection) quantitySection.style.display = 'none';
            } else {
                if (quantitySection) quantitySection.style.display = 'flex';
            }

            // Set main image
            if (product.image) {
                mainImage.classList.remove('placeholder-image');
                mainImage.innerHTML = `<img src="${product.image}" alt="${product.name}" id="product-image">`;
            } else {
                mainImage.classList.add('placeholder-image');
                mainImage.innerHTML = `<span class="image-placeholder">${product.placeholder || 'ðŸ“¦'}</span>`;
            }

            // Set variant tabs
            if (product.variants && product.variants.length > 0) {
                variantTabs.innerHTML = product.variants.map((variant, index) => `
                    <button class="variant-tab ${index === 0 ? 'active' : ''}" data-variant-index="${index}">
                        ${product.image ?
                            `<img src="${product.image}" alt="${variant.name}">` :
                            `<div class="tab-placeholder">${product.placeholder || 'ðŸ“¦'}</div>`
                        }
                        <span>${variant.name}</span>
                    </button>
                `).join('');

                // Add click handlers
                variantTabs.querySelectorAll('.variant-tab').forEach(tab => {
                    tab.addEventListener('click', function() {
                        const index = parseInt(this.dataset.variantIndex);
                        currentVariant = product.variants[index];
                        variantTabs.querySelectorAll('.variant-tab').forEach(t => t.classList.remove('active'));
                        this.classList.add('active');
                        updateVariantContent();
                    });
                });
            } else {
                variantTabs.innerHTML = '';
            }

            // Set details info
            updateVariantContent();

            quantityInput.value = productQuantity;
            updateAddToCartButton();
            modal.style.display = 'flex';
        }

        function updateVariantContent() {
            const detailsInfo = document.getElementById('product-details-info');
            const productType = currentProduct.type || 'physical';

            let html = `
                <div class="variant-content active">
                    <h2>${currentProduct.name}</h2>
                    <p>${currentVariant?.description || currentProduct.description}</p>
            `;

            // Physical products: show color options with per-color quantity counters
            if (productType === 'physical' && currentProduct.colors && currentProduct.colors.length > 0) {
                const price = currentProduct.price || 25;
                html += `
                    <div class="color-options">
                        <h3>Select Color & Quantity</h3>
                        <div class="booking-color-qty-list" style="display: flex; flex-direction: column; gap: 10px;">
                            ${currentProduct.colors.map((color, index) => `
                                <div class="booking-color-qty-item" data-color-index="${index}" data-color-name="${color.name}"
                                     style="display: flex; justify-content: space-between; align-items: center; padding: 12px 16px; background: #f9f9f9; border-radius: 8px; border: 1px solid #eee; transition: all 0.2s;">
                                    <div style="display: flex; align-items: center; gap: 12px;">
                                        <img src="${color.image}" alt="${color.name}" style="width: 50px; height: 50px; border-radius: 6px; object-fit: cover;">
                                        <div>
                                            <span style="font-size: 14px; font-weight: 500; color: #333;">${color.name}</span>
                                            <span style="font-size: 13px; color: #666; margin-left: 8px;">$${price.toFixed(2)}</span>
                                        </div>
                                    </div>
                                    <div class="booking-color-qty-controls" style="display: flex; align-items: center; gap: 8px;">
                                        <button type="button" class="booking-color-qty-btn" data-color-index="${index}" data-action="decrease" disabled
                                                style="width: 32px; height: 32px; border: 1px solid #ddd; border-radius: 4px; background: white; cursor: pointer; opacity: 0.3;">-</button>
                                        <span class="booking-color-qty-value" data-color-index="${index}" style="min-width: 24px; text-align: center; font-size: 14px; font-weight: 500;">0</span>
                                        <button type="button" class="booking-color-qty-btn" data-color-index="${index}" data-action="increase"
                                                style="width: 32px; height: 32px; border: 1px solid #ddd; border-radius: 4px; background: white; cursor: pointer;">+</button>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                        <div class="booking-color-totals" style="margin-top: 16px; padding-top: 16px; border-top: 1px solid #eee; display: flex; justify-content: space-between; align-items: center;">
                            <span class="booking-color-total-items" style="font-size: 14px; color: #666;">0 items selected</span>
                            <span class="booking-color-total-price" style="font-size: 18px; font-weight: 600; color: #E20021;">$0.00</span>
                        </div>
                    </div>
                `;
            }

            // Scheduled products: show date picker and optional time picker or operation hours
            if (productType === 'scheduled') {
                const today = new Date().toISOString().split('T')[0];
                const hasTimeSlots = currentProduct.availableTimes && currentProduct.availableTimes.length > 0;
                const hasOperationHours = currentProduct.operationHours;
                html += `
                    <div class="addon-date-time-section" style="margin-top: 16px;">
                        <h3>Select Date${hasTimeSlots ? ' & Time' : ''}</h3>
                        <div style="display: flex; gap: 12px; flex-wrap: wrap; align-items: center;">
                            <input type="date" id="addon-date-picker" min="${today}"
                                   style="flex: 1; min-width: 150px; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 16px;">
                            ${hasTimeSlots ? `
                                <select id="addon-time-picker" style="flex: 1; min-width: 120px; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 16px; background: white;">
                                    <option value="">Select Time</option>
                                    ${currentProduct.availableTimes.map(time => `<option value="${time}">${time}</option>`).join('')}
                                </select>
                            ` : ''}
                            ${hasOperationHours ? `
                                <div style="flex: 1; min-width: 150px; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 16px; background: #f5f5f5; color: #333;">
                                    All day, operation hours "${currentProduct.operationHours}"
                                </div>
                            ` : ''}
                        </div>
                    </div>
                `;
            }

            // Validity pass: show valid until info
            if (productType === 'validityPass' && currentProduct.validUntil) {
                html += `
                    <div class="addon-validity-info" style="margin-top: 16px; padding: 12px; background: #f0f9ff; border-radius: 8px; border-left: 4px solid #0ea5e9;">
                        <p style="margin: 0; color: #0369a1; font-weight: 500;">
                            <span style="margin-right: 8px;">ðŸ“…</span>
                            Valid until ${currentProduct.validUntil}
                        </p>
                    </div>
                `;
            }

            // Scheduled and ValidityPass: show adult/child ticket selectors
            if (productType === 'scheduled' || productType === 'validityPass') {
                const adultPrice = currentProduct.adultPrice || currentProduct.price || 0;
                const childPrice = currentProduct.childPrice || currentProduct.price || 0;
                html += `
                    <div class="addon-ticket-section" style="margin-top: 16px;">
                        <h3>Select Tickets</h3>
                        <div class="addon-ticket-row" style="display: flex; justify-content: space-between; align-items: center; padding: 12px 0; border-bottom: 1px solid #eee;">
                            <div>
                                <span style="font-weight: 500;">Adult</span>
                                <span style="color: #666; font-size: 14px; margin-left: 8px;">$${adultPrice.toFixed(2)}</span>
                            </div>
                            <div class="quantity-selector" style="display: flex; align-items: center; gap: 8px;">
                                <button type="button" class="addon-qty-btn" data-type="adult" data-action="decrease" style="width: 32px; height: 32px; border: 1px solid #ddd; border-radius: 6px; background: white; cursor: pointer;">-</button>
                                <span id="addon-adult-qty" style="min-width: 24px; text-align: center;">0</span>
                                <button type="button" class="addon-qty-btn" data-type="adult" data-action="increase" style="width: 32px; height: 32px; border: 1px solid #ddd; border-radius: 6px; background: white; cursor: pointer;">+</button>
                            </div>
                        </div>
                        <div class="addon-ticket-row" style="display: flex; justify-content: space-between; align-items: center; padding: 12px 0;">
                            <div>
                                <span style="font-weight: 500;">Child</span>
                                <span style="color: #666; font-size: 14px; margin-left: 8px;">$${childPrice.toFixed(2)}</span>
                            </div>
                            <div class="quantity-selector" style="display: flex; align-items: center; gap: 8px;">
                                <button type="button" class="addon-qty-btn" data-type="child" data-action="decrease" style="width: 32px; height: 32px; border: 1px solid #ddd; border-radius: 6px; background: white; cursor: pointer;">-</button>
                                <span id="addon-child-qty" style="min-width: 24px; text-align: center;">0</span>
                                <button type="button" class="addon-qty-btn" data-type="child" data-action="increase" style="width: 32px; height: 32px; border: 1px solid #ddd; border-radius: 6px; background: white; cursor: pointer;">+</button>
                            </div>
                        </div>
                    </div>
                `;
            }

            html += '</div>';
            detailsInfo.innerHTML = html;

            // Add per-color quantity handlers (physical products)
            const colorQtyList = detailsInfo.querySelector('.booking-color-qty-list');
            if (colorQtyList) {
                // Helper to update totals display
                const updateBookingColorTotals = () => {
                    let totalItems = 0;
                    let totalPrice = 0;
                    const price = currentProduct?.price || 25;

                    detailsInfo.querySelectorAll('.booking-color-qty-value').forEach(el => {
                        const qty = parseInt(el.textContent) || 0;
                        totalItems += qty;
                        totalPrice += qty * price;
                    });

                    const totalItemsEl = detailsInfo.querySelector('.booking-color-total-items');
                    const totalPriceEl = detailsInfo.querySelector('.booking-color-total-price');
                    if (totalItemsEl) totalItemsEl.textContent = `${totalItems} item${totalItems !== 1 ? 's' : ''} selected`;
                    if (totalPriceEl) totalPriceEl.textContent = `$${totalPrice.toFixed(2)}`;

                    // Update item highlight states
                    detailsInfo.querySelectorAll('.booking-color-qty-item').forEach(item => {
                        const qty = parseInt(item.querySelector('.booking-color-qty-value').textContent) || 0;
                        if (qty > 0) {
                            item.style.borderColor = '#E20021';
                            item.style.background = '#fff5f7';
                        } else {
                            item.style.borderColor = '#eee';
                            item.style.background = '#f9f9f9';
                        }
                    });

                    updateAddToCartButton();
                };

                // Handle color quantity button clicks
                colorQtyList.addEventListener('click', function(e) {
                    const btn = e.target.closest('.booking-color-qty-btn');
                    if (!btn) return;

                    e.preventDefault();
                    e.stopPropagation();

                    const colorIndex = btn.dataset.colorIndex;
                    const action = btn.dataset.action;
                    const qtyDisplay = detailsInfo.querySelector(`.booking-color-qty-value[data-color-index="${colorIndex}"]`);
                    const decreaseBtn = detailsInfo.querySelector(`.booking-color-qty-btn[data-color-index="${colorIndex}"][data-action="decrease"]`);

                    if (!qtyDisplay) return;

                    let qty = parseInt(qtyDisplay.textContent) || 0;

                    if (action === 'increase') {
                        qty++;
                    } else if (action === 'decrease' && qty > 0) {
                        qty--;
                    }

                    qtyDisplay.textContent = qty;

                    // Update decrease button state
                    if (decreaseBtn) {
                        decreaseBtn.disabled = qty === 0;
                        decreaseBtn.style.opacity = qty === 0 ? '0.3' : '1';
                    }

                    updateBookingColorTotals();
                });
            }

            // Add date picker handler (scheduled products)
            const datePicker = document.getElementById('addon-date-picker');
            if (datePicker) {
                datePicker.addEventListener('change', function() {
                    productSelectedDate = this.value;
                    updateAddToCartButton();
                });
            }

            // Add time picker handler (scheduled products with time slots)
            const timePicker = document.getElementById('addon-time-picker');
            if (timePicker) {
                timePicker.addEventListener('change', function() {
                    productSelectedTime = this.value;
                    updateAddToCartButton();
                });
            }

            // Add adult/child quantity handlers (scheduled/validityPass)
            detailsInfo.querySelectorAll('.addon-qty-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const type = this.dataset.type;
                    const action = this.dataset.action;

                    if (type === 'adult') {
                        if (action === 'increase') productAdultQty++;
                        else if (action === 'decrease' && productAdultQty > 0) productAdultQty--;
                        document.getElementById('addon-adult-qty').textContent = productAdultQty;
                    } else if (type === 'child') {
                        if (action === 'increase') productChildQty++;
                        else if (action === 'decrease' && productChildQty > 0) productChildQty--;
                        document.getElementById('addon-child-qty').textContent = productChildQty;
                    }

                    updateAddToCartButton();
                });
            });
        }

        function updateAddToCartButton() {
            const btn = document.getElementById('add-to-cart-btn');
            const productType = currentProduct?.type || 'physical';
            let total = 0;
            let totalItems = 0;

            if (productType === 'physical') {
                // Check for per-color quantity UI
                const colorQtyValues = document.querySelectorAll('.booking-color-qty-value');
                if (colorQtyValues.length > 0) {
                    // Per-color quantity mode
                    const price = currentProduct?.price || 25;
                    colorQtyValues.forEach(el => {
                        const qty = parseInt(el.textContent) || 0;
                        totalItems += qty;
                        total += qty * price;
                    });
                    btn.disabled = totalItems === 0;
                } else {
                    // Legacy single quantity mode
                    total = (currentProduct?.price || 0) * productQuantity;
                    totalItems = productQuantity;
                }
            } else if (productType === 'scheduled' || productType === 'validityPass') {
                const adultPrice = currentProduct?.adultPrice || currentProduct?.price || 0;
                const childPrice = currentProduct?.childPrice || currentProduct?.price || 0;
                total = (productAdultQty * adultPrice) + (productChildQty * childPrice);
                totalItems = productAdultQty + productChildQty;
            }

            btn.textContent = `Add to Cart - $${total.toFixed(2)}`;
        }

        // Step navigation
        function initStepNavigation() {
            document.getElementById('continue-to-step2').addEventListener('click', () => {
                // Validate step 1
                const adultCount = parseInt(document.getElementById('adult-count').value) || 0;
                const childCount = parseInt(document.getElementById('child-count').value) || 0;

                if (adultCount === 0 && childCount === 0) {
                    alert('Please select at least one ticket.');
                    return;
                }

                if (!selectedDate) {
                    alert('Please select a date.');
                    return;
                }

                // Populate Step 2 order summary and navigate
                populateStep2OrderSummary();
                showStep('step2');
            });

            document.getElementById('back-to-step1').addEventListener('click', () => {
                showStep('step1');
            });

            document.getElementById('continue-to-step3').addEventListener('click', () => {
                // Validate step 2
                const fullName = document.getElementById('full-name').value.trim();
                const email = document.getElementById('email').value.trim();
                const phone = document.getElementById('phone').value.trim();
                const termsAgree = document.getElementById('terms-agree').checked;

                if (!fullName || !email || !phone) {
                    alert('Please fill in all required fields.');
                    return;
                }

                if (!termsAgree) {
                    alert('Please agree to the Terms and Conditions.');
                    return;
                }

                transferOrderSummary();
                showStep('step3');
            });

            document.getElementById('back-to-step2').addEventListener('click', () => {
                showStep('step2');
            });

            document.getElementById('make-payment').addEventListener('click', () => {
                // Simulate payment
                showStep('step4');

                // Clear the cart and hide cart bar after payment completion
                UpsellCart.items = [];
                UpsellCart.updateCartUI();
            });
        }

        function showStep(stepId) {
            document.querySelectorAll('.booking-step-page').forEach(step => {
                step.classList.remove('active');
            });
            document.getElementById(stepId).classList.add('active');
            window.scrollTo(0, 0);

            // Hide cart bar when entering step 2 or beyond (order summary visible)
            const cartBar = document.getElementById('upsell-cart-bar');
            if (cartBar) {
                if (stepId === 'step2' || stepId === 'step3' || stepId === 'step4') {
                    cartBar.classList.remove('visible');
                    document.body.classList.remove('cart-visible');
                } else if (stepId === 'step1' && UpsellCart.getItemCount() > 0) {
                    // Show cart bar again when going back to step 1 (if items exist)
                    cartBar.classList.add('visible');
                    document.body.classList.add('cart-visible');
                }
            }
        }

        function transferOrderSummary() {
            const tourSelect = document.getElementById('tour-select');
            const selectedTour = tourSelect.value;
            const pricing = tourPricing[selectedTour];

            const adultCount = parseInt(document.getElementById('adult-count').value) || 0;
            const childCount = parseInt(document.getElementById('child-count').value) || 0;

            const ticketsContainer = document.getElementById('order-tickets');
            const addonsContainer = document.getElementById('order-addons');
            const addonsSection = document.getElementById('addons-section');

            // Populate the tour date in order summary
            const orderTourDate = document.getElementById('order-tour-date');
            if (orderTourDate && selectedDate) {
                const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
                orderTourDate.textContent = selectedDate.toLocaleDateString('en-US', options);
            }

            let ticketsHtml = '';
            let subtotal = 0;
            let originalSubtotal = 0;

            // Add adult tickets (read-only in payment stage)
            if (adultCount > 0) {
                const adultTotal = adultCount * pricing.adult.current;
                const adultOriginal = adultCount * pricing.adult.original;
                subtotal += adultTotal;
                originalSubtotal += adultOriginal;

                ticketsHtml += `
                    <div class="order-item" data-type="adult">
                        <div class="order-item-info">
                            <div class="order-item-details">
                                <h5>Adult Ticket</h5>
                                <span class="order-item-meta">${selectedTour === 'tour01' ? 'Downtown Palace Namsan Course' : 'Night View Course'}</span>
                            </div>
                        </div>
                        <div class="order-item-controls">
                            <div class="order-item-qty">
                                <span class="qty-display">Ã— ${adultCount}</span>
                            </div>
                            <div class="order-item-price">
                                <span class="order-item-current">$${adultTotal.toFixed(2)}</span>
                                ${adultOriginal > adultTotal ? `<span class="order-item-original">$${adultOriginal.toFixed(2)}</span>` : ''}
                            </div>
                        </div>
                    </div>
                `;
            }

            // Add child tickets (read-only in payment stage)
            if (childCount > 0) {
                const childTotal = childCount * pricing.child.current;
                const childOriginal = childCount * pricing.child.original;
                subtotal += childTotal;
                originalSubtotal += childOriginal;

                ticketsHtml += `
                    <div class="order-item" data-type="child">
                        <div class="order-item-info">
                            <div class="order-item-details">
                                <h5>Child Ticket</h5>
                                <span class="order-item-meta">${selectedTour === 'tour01' ? 'Downtown Palace Namsan Course' : 'Night View Course'}</span>
                            </div>
                        </div>
                        <div class="order-item-controls">
                            <div class="order-item-qty">
                                <span class="qty-display">Ã— ${childCount}</span>
                            </div>
                            <div class="order-item-price">
                                <span class="order-item-current">$${childTotal.toFixed(2)}</span>
                                ${childOriginal > childTotal ? `<span class="order-item-original">$${childOriginal.toFixed(2)}</span>` : ''}
                            </div>
                        </div>
                    </div>
                `;
            }

            ticketsContainer.innerHTML = ticketsHtml;

            // Add add-ons
            if (UpsellCart.items.length > 0) {
                addonsSection.style.display = 'block';
                let addonsHtml = '';

                UpsellCart.items.forEach((item, index) => {
                    const itemTotal = item.price * item.quantity;
                    const itemOriginal = item.originalPrice * item.quantity;
                    subtotal += itemTotal;
                    originalSubtotal += itemOriginal;

                    // Build meta description based on item type
                    let metaDesc = item.variant || '';
                    if (item.type === 'scheduled') {
                        const dateStr = item.selectedDate ? item.selectedDate : '';
                        const timeStr = item.selectedTime ? ` @ ${item.selectedTime}` : '';
                        metaDesc = `${dateStr}${timeStr}`;
                        if (item.adultQty || item.childQty) {
                            metaDesc += ` â€¢ Adult: ${item.adultQty || 0}, Child: ${item.childQty || 0}`;
                        }
                    } else if (item.type === 'physical') {
                        metaDesc = `${item.variant}${item.color ? ` - ${item.color}` : ''}`;
                    } else if (item.type === 'validityPass') {
                        metaDesc = `Adult: ${item.adultQty || 0}, Child: ${item.childQty || 0}`;
                    }

                    addonsHtml += `
                        <div class="order-item" data-addon-index="${index}">
                            <div class="order-item-info">
                                ${item.image ?
                                    `<img src="${item.image}" alt="${item.name}" class="order-item-image">` :
                                    `<div class="order-item-image" style="background: #f5f5f5; display: flex; align-items: center; justify-content: center; font-size: 24px; border-radius: 8px;">${item.placeholder || 'ðŸ“¦'}</div>`
                                }
                                <div class="order-item-details">
                                    <h5>${item.name}</h5>
                                    <span class="order-item-meta">${metaDesc}</span>
                                </div>
                            </div>
                            <div class="order-item-controls">
                                <div class="order-item-qty">
                                    <span class="qty-display">Ã— ${item.quantity}</span>
                                </div>
                                <div class="order-item-price">
                                    <span class="order-item-current">$${itemTotal.toFixed(2)}</span>
                                </div>
                            </div>
                        </div>
                    `;
                });

                addonsContainer.innerHTML = addonsHtml;
            } else {
                addonsSection.style.display = 'none';
            }

            // Update totals
            const savings = originalSubtotal - subtotal;
            document.getElementById('order-subtotal').textContent = `$${originalSubtotal.toFixed(2)}`;
            document.getElementById('order-total').textContent = `$${subtotal.toFixed(2)}`;

            if (savings > 0) {
                document.getElementById('order-savings-row').style.display = 'flex';
                document.getElementById('order-savings').textContent = `-$${savings.toFixed(2)}`;
            } else {
                document.getElementById('order-savings-row').style.display = 'none';
            }

            // Bind controls
            bindOrderSummaryControls();
        }

        function bindOrderSummaryControls() {
            // Ticket quantity controls
            document.querySelectorAll('.qty-decrease, .qty-increase').forEach(btn => {
                btn.addEventListener('click', function() {
                    const type = this.dataset.type;
                    const input = document.getElementById(`${type}-count`);
                    let value = parseInt(input.value) || 0;

                    if (this.classList.contains('qty-increase')) {
                        value++;
                    } else if (value > 0) {
                        value--;
                    }

                    input.value = value;
                    updateTotals();
                    transferOrderSummary();
                });
            });

            // Add-on quantity controls
            document.querySelectorAll('.addon-decrease, .addon-increase').forEach(btn => {
                btn.addEventListener('click', function() {
                    const index = parseInt(this.dataset.index);
                    const item = UpsellCart.items[index];

                    if (this.classList.contains('addon-increase')) {
                        UpsellCart.updateItemQuantity(index, item.quantity + 1);
                    } else if (item.quantity > 1) {
                        UpsellCart.updateItemQuantity(index, item.quantity - 1);
                    } else {
                        UpsellCart.removeItem(index);
                    }

                    transferOrderSummary();
                });
            });

            // Remove add-on buttons
            document.querySelectorAll('.remove-item-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const index = parseInt(this.dataset.index);
                    UpsellCart.removeItem(index);
                    transferOrderSummary();
                });
            });
        }

        // Cart bar
        function initCartBar() {
            const viewCartBtn = document.getElementById('view-cart-btn');
            const collapseCartBtn = document.getElementById('collapse-cart');
            const cartExpanded = document.getElementById('cart-expanded');
            const continueBookingBtn = document.getElementById('continue-booking-btn');

            viewCartBtn.addEventListener('click', () => {
                cartExpanded.classList.toggle('visible');
            });

            collapseCartBtn.addEventListener('click', () => {
                cartExpanded.classList.remove('visible');
            });

            // Continue Booking button - same validation as the main Continue button
            if (continueBookingBtn) {
                continueBookingBtn.addEventListener('click', () => {
                    const adultCount = parseInt(document.getElementById('adult-count').value) || 0;
                    const childCount = parseInt(document.getElementById('child-count').value) || 0;

                    if (adultCount === 0 && childCount === 0) {
                        alert('Please select at least one ticket.');
                        return;
                    }

                    if (!selectedDate) {
                        alert('Please select a date.');
                        return;
                    }

                    // Populate Step 2 order summary and navigate
                    populateStep2OrderSummary();
                    showStep('step2');
                });
            }
        }

        // Populate order summary for Step 2
        function populateStep2OrderSummary() {
            const tourSelect = document.getElementById('tour-select');
            const selectedTour = tourSelect.value;
            const pricing = tourPricing[selectedTour];

            const adultCount = parseInt(document.getElementById('adult-count').value) || 0;
            const childCount = parseInt(document.getElementById('child-count').value) || 0;

            const ticketsContainer = document.getElementById('step2-order-tickets');
            const addonsContainer = document.getElementById('step2-order-addons');
            const addonsSection = document.getElementById('step2-addons-section');

            // Get tour name
            const tourNames = {
                'tour01': 'Downtown Palace Namsan Course',
                'tour04': 'Night View Course',
                'tour02': 'Panorama Course'
            };

            // Format the selected date
            let formattedDate = '';
            if (selectedDate) {
                const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
                formattedDate = selectedDate.toLocaleDateString('en-US', options);
            }

            // Populate the tour date in order summary
            const orderTourDate = document.getElementById('step2-order-tour-date');
            if (orderTourDate && selectedDate) {
                orderTourDate.textContent = formattedDate;
            }

            let ticketsHtml = '';
            let subtotal = 0;
            let originalSubtotal = 0;

            // Calculate totals
            const adultTotal = adultCount * pricing.adult.current;
            const adultOriginal = adultCount * pricing.adult.original;
            const childTotal = childCount * pricing.child.current;
            const childOriginal = childCount * pricing.child.original;

            subtotal = adultTotal + childTotal;
            originalSubtotal = adultOriginal + childOriginal;

            // Build ticket summary with editable counters
            if (adultCount > 0) {
                ticketsHtml += `
                    <div class="order-item" data-type="adult">
                        <div class="order-item-info">
                            <div class="order-item-details">
                                <h5>${tourNames[selectedTour] || selectedTour}</h5>
													<span class="order-item-meta">Adult</span>
                            </div>
                        </div>
                        <div class="order-item-controls">
                            <div class="order-item-qty">
                                <button class="step2-ticket-decrease" data-type="adult">-</button>
                                <span id="step2AdultQty">${adultCount}</span>
                                <button class="step2-ticket-increase" data-type="adult">+</button>
                            </div>
                            <div class="order-item-price">
                                <span class="order-item-current" id="step2AdultPrice">$${adultTotal.toFixed(2)}</span>
                            </div>
                        </div>
                    </div>
                `;
            }
            if (childCount > 0) {
                ticketsHtml += `
                    <div class="order-item" data-type="child">
                        <div class="order-item-info">
                            <div class="order-item-details">
                                <h5>${tourNames[selectedTour] || selectedTour}</h5>
													<span class="order-item-meta">Child</span>
                            </div>
                        </div>
                        <div class="order-item-controls">
                            <div class="order-item-qty">
                                <button class="step2-ticket-decrease" data-type="child">-</button>
                                <span id="step2ChildQty">${childCount}</span>
                                <button class="step2-ticket-increase" data-type="child">+</button>
                            </div>
                            <div class="order-item-price">
                                <span class="order-item-current" id="step2ChildPrice">$${childTotal.toFixed(2)}</span>
                            </div>
                        </div>
                    </div>
                `;
            }

            ticketsContainer.innerHTML = ticketsHtml;
            // Bind step2 ticket controls
            bindStep2TicketControls();

            // Add add-ons with editable counters
            if (UpsellCart.items.length > 0) {
                addonsSection.style.display = 'block';
                let addonsHtml = '';

                UpsellCart.items.forEach((item, index) => {
                    const itemTotal = item.computedLinePrice || (item.price * item.quantity);
                    const itemOriginal = item.originalPrice * item.quantity;
                    subtotal += itemTotal;
                    originalSubtotal += itemOriginal;

                    // Build meta description based on item type
                    let metaDesc = item.variant || '';
                    if (item.type === 'scheduled') {
                        const dateStr = item.selectedDate ? item.selectedDate : '';
                        const timeStr = item.selectedTime ? ` @ ${item.selectedTime}` : '';
                        metaDesc = `${dateStr}${timeStr}`;
                        if (item.adultQty || item.childQty) {
                            metaDesc += ` â€¢ Adult: ${item.adultQty || 0}, Child: ${item.childQty || 0}`;
                        }
                    } else if (item.type === 'physical') {
                        metaDesc = `${item.variant}${item.color ? ` - ${item.color}` : ''}`;
                    } else if (item.type === 'validityPass') {
                        metaDesc = `Adult: ${item.adultQty || 0}, Child: ${item.childQty || 0}`;
                    }

                    addonsHtml += `
                        <div class="order-item addon-item" data-addon-index="${index}">
                            <div class="order-item-info">
                                ${item.image ?
                                    `<img src="${item.image}" alt="${item.name}" class="order-item-image">` :
                                    `<div class="order-item-image" style="background: #f5f5f5; display: flex; align-items: center; justify-content: center; font-size: 24px; border-radius: 8px;">${item.placeholder || 'ðŸ“¦'}</div>`
                                }
                                <div class="order-item-details">
                                    <h5>${item.name}</h5>
                                    <span class="order-item-meta">${metaDesc}</span>
                                </div>
                            </div>
                            <div class="order-item-controls">
                                <div class="order-item-qty">
                                    <button class="step2-addon-decrease" data-index="${index}">-</button>
                                    <span>${item.quantity}</span>
                                    <button class="step2-addon-increase" data-index="${index}">+</button>
                                </div>
                                <div class="order-item-price">
                                    <span class="order-item-current">$${itemTotal.toFixed(2)}</span>
                                </div>
                                <button class="step2-remove-addon-btn" data-index="${index}" title="Remove add-on">Ã—</button>
                            </div>
                        </div>
                    `;
                });

                addonsContainer.innerHTML = addonsHtml;
                // Bind step2 addon controls
                bindStep2AddonControls();
            } else {
                addonsSection.style.display = 'none';
            }

            // Update totals
            updateStep2Totals();
        }

        // Bind step2 ticket controls for booking.html
        function bindStep2TicketControls() {
            const step2 = document.getElementById('step2');
            if (!step2) return;

            const tourSelect = document.getElementById('tour-select');
            const selectedTour = tourSelect ? tourSelect.value : 'tour01';
            const pricing = tourPricing[selectedTour];

            step2.querySelectorAll('.step2-ticket-decrease, .step2-ticket-increase').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();

                    const type = this.dataset.type;
                    const isIncrease = this.classList.contains('step2-ticket-increase');
                    const qtySpan = step2.querySelector(`#step2${type.charAt(0).toUpperCase() + type.slice(1)}Qty`);
                    const priceSpan = step2.querySelector(`#step2${type.charAt(0).toUpperCase() + type.slice(1)}Price`);

                    if (qtySpan) {
                        let currentQty = parseInt(qtySpan.textContent) || 0;
                        if (isIncrease) {
                            currentQty++;
                        } else {
                            currentQty = Math.max(0, currentQty - 1);
                        }
                        qtySpan.textContent = currentQty;

                        // Update price
                        const price = type === 'adult' ? pricing.adult.current : pricing.child.current;
                        if (priceSpan) {
                            priceSpan.textContent = `$${(price * currentQty).toFixed(2)}`;
                        }

                        // Update the main form inputs
                        const countInput = document.getElementById(`${type}-count`);
                        if (countInput) {
                            countInput.value = currentQty;
                        }

                        // Update totals
                        updateStep2Totals();
                    }
                });
            });
        }

        // Bind step2 addon controls for booking.html
        function bindStep2AddonControls() {
            const step2 = document.getElementById('step2');
            if (!step2) return;

            // Remove buttons
            step2.querySelectorAll('.step2-remove-addon-btn').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();

                    const index = parseInt(this.dataset.index);
                    UpsellCart.removeItem(index);
                    populateStep2OrderSummary();
                    if (typeof updateCartBarUI === 'function') {
                        updateCartBarUI();
                    }
                });
            });

            // Quantity controls
            step2.querySelectorAll('.step2-addon-decrease, .step2-addon-increase').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();

                    const index = parseInt(this.dataset.index);
                    const isIncrease = this.classList.contains('step2-addon-increase');

                    if (UpsellCart.items[index]) {
                        if (isIncrease) {
                            UpsellCart.items[index].quantity++;
                        } else {
                            UpsellCart.items[index].quantity = Math.max(1, UpsellCart.items[index].quantity - 1);
                        }
                        // Update computed price
                        if (UpsellCart.items[index].computedLinePrice) {
                            UpsellCart.items[index].computedLinePrice = UpsellCart.items[index].price * UpsellCart.items[index].quantity;
                        }
                        UpsellCart.save();
                        populateStep2OrderSummary();
                        if (typeof updateCartBarUI === 'function') {
                            updateCartBarUI();
                        }
                    }
                });
            });
        }

        // Update step2 totals for booking.html
        function updateStep2Totals() {
            const tourSelect = document.getElementById('tour-select');
            const selectedTour = tourSelect ? tourSelect.value : 'tour01';
            const pricing = tourPricing[selectedTour];

            const step2 = document.getElementById('step2');
            const adultQtyEl = step2 ? step2.querySelector('#step2AdultQty') : null;
            const childQtyEl = step2 ? step2.querySelector('#step2ChildQty') : null;
            const adultCount = adultQtyEl ? parseInt(adultQtyEl.textContent) || 0 : parseInt(document.getElementById('adult-count').value) || 0;
            const childCount = childQtyEl ? parseInt(childQtyEl.textContent) || 0 : parseInt(document.getElementById('child-count').value) || 0;

            const adultTotal = adultCount * pricing.adult.current;
            const adultOriginal = adultCount * pricing.adult.original;
            const childTotal = childCount * pricing.child.current;
            const childOriginal = childCount * pricing.child.original;

            let subtotal = adultTotal + childTotal;
            let originalSubtotal = adultOriginal + childOriginal;

            // Add add-ons
            UpsellCart.items.forEach(item => {
                const itemTotal = item.computedLinePrice || (item.price * item.quantity);
                const itemOriginal = item.originalPrice * item.quantity;
                subtotal += itemTotal;
                originalSubtotal += itemOriginal;
            });

            const savings = originalSubtotal - subtotal;
            document.getElementById('step2-order-subtotal').textContent = `$${originalSubtotal.toFixed(2)}`;
            document.getElementById('step2-order-total').textContent = `$${subtotal.toFixed(2)}`;

            if (savings > 0) {
                document.getElementById('step2-order-savings-row').style.display = 'flex';
                document.getElementById('step2-order-savings').textContent = `-$${savings.toFixed(2)}`;
            } else {
                document.getElementById('step2-order-savings-row').style.display = 'none';
            }
        }
    </script>
</body>
</html>